<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- meta name="viewport" content="width=device-width, initial-scale=1.0" -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>Ciaccona - Swipe</title>

    <link href="/global.css?v=0.13.1" rel="stylesheet">
    <style>
        body {
            width: 100vw;
            height: 100vh;
        }

        .both {
            display: flex;
            align-items: center;
            width: 100%;
        }

        #left,
        #right {
            width: 100vw;
            height: 100vh;
            visibility: hidden;
        }

        #left {
            background-color: red;
        }

        #right {
            background-color: blue;
        }
    </style>
    <!-- 

        <link href="/index.css?v=0.13.1" rel="stylesheet">
        <link href="/ciaccona.css?v=0.13.1" rel="stylesheet">
        <link href="/index.svg.css?v=0.13.1" rel="stylesheet">
    -->
    <!-- video player -->
    <link rel="stylesheet" href="/lib/plyr-3.7.8.css">
    <!-- bootstrap -->
    <link rel="stylesheet" href="/lib/bootstrap-5.2.3.min.css">
</head>

<body id="body">

    <div class='both'>
        <div id="left" class="artists fullscreen"></div>
        <div id="right" class="ciaccona fullscreen"></div>
    </div>


    <!-- script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></!
        https://css-tricks.com/simple-swipe-with-vanilla-javascript/
    -->
    <script src="fetch-data-loader.js?v=0.13.1.2"></script>


    <script type="module">
        import hammerjs from "https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/+esm"
        import config from "/js/config.js?v=0.13.1"

        // transform packery event into promise
        const allesIstVollbracht = new Promise((resolve) => {
            window.addEventListener('allesistvollbracht', (event) => {
                console.log("... heard allesistvollbracht event");
                resolve(event)
            }, { once: true })
        })

        function setOrTogglePane(newPane) {
            if (typeof newPane === 'undefined' || !(newPane === 0 || newPane === 1)) {
                if (config.pane === 0) {
                    config.pane = 1
                } else {
                    config.pane = 0
                }
            } else {
                config.pane = newPane % 2
            }
            if (config.pane === 0) {
                document.getElementById('right').style.visibility = 'hidden'
                // document.getElementById('right').style.display = 'none'
                document.getElementById('left').style.visibility = 'visible'
                // document.getElementById('left').style.display = 'inherit'
            } else {
                document.getElementById('right').style.visibility = 'visible'
                // document.getElementById('right').style.display = 'inherit'
                document.getElementById('left').style.visibility = 'hidden'
                // document.getElementById('left').style.display = 'none'
            }
        }

        const hammerRight = new Hammer(document.getElementById('right'), {});
        hammerRight.on('swipeleft', function (ev) {
            setOrTogglePane(1)
        });
        const hammerLeft = new Hammer(document.getElementById('left'), {});
        hammerLeft.on('swiperight', function (ev) {
            setOrTogglePane(0)
        });

        window.addEventListener("ciacconaLoaded", (event) => {
            console.log("ciaccona.html fully loaded and parsed");
            console.log('shout calcBrickWidth event ...')
            window.dispatchEvent(new Event('calcBrickWidth'));
            document.querySelectorAll('#gb-ciaccona a').forEach(a => {
                a.setAttribute('href', '#')
                a.addEventListener('click', ev => {
                    setOrTogglePane(0)
                })
            })
        });

        window.addEventListener("artistsLoaded", (event) => {
            console.log("index.html fully loaded and parsed");
            console.log('shout calcItemWidth event ...')
            window.dispatchEvent(new Event('calcItemWidth'));
            document.querySelectorAll('#li-ciaccona a').forEach(a => {
                a.setAttribute('href', '#')
                a.addEventListener('click', ev => {
                    setOrTogglePane(1)
                })
            })
        });

        const indexLoaded = new Promise((resolve, reject) => {
            fetch('index.html?v=0.13.1').then(function (response) {
                return response.text()
            }).then(function (html) {
                loadData(html, '#left').then(function (html) {
                    resolve(true)
                });
            }).catch(function (err) {
                console.log('Failed to fetch page index.html: ', err);
                reject(err)
            });
        })

        const ciacconaLoaded = new Promise((resolve, reject) => {
            fetch('ciaccona.html?v=0.13.1').then(function (response) {
                return response.text()
            }).then(function (html) {
                loadData(html, '#right').then(function (html) {
                    resolve(true)
                });
            }).catch(function (err) {
                console.log('Failed to fetch page ciaccona.html: ', err);
                reject(err)
            });
        })

        console.log('waiting for index.html and ciacconna.html to be fully loaded, then waiting for allesIstVollbracht event')
        Promise.allSettled([indexLoaded, ciacconaLoaded, allesIstVollbracht]).then((results) => {
            console.log('ALLES IST VOLLBRACHT !!!')
            setOrTogglePane(config.pane)
        })

    </script>
</body>

</html>