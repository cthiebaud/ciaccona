<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DJBNRY1Z9M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-DJBNRY1Z9M');
    </script>
    <meta charset="utf-8">
    <!-- meta name="viewport" content="width=device-width, initial-scale=1" -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="keywords" content="Bach, JSBach, J.S. Bach, BWV1004, BWV 1004, Partita, 2nd Partita, Ciaconna, Chaconne">
    <meta name="author" content="Christophe Thiebaud">

    <!-- HTML Meta Tags -->
    <title>Ciaccona Performers</title>
    <meta name="description" content="Performers of Ciaccona from Johann Sebastian Bach's Partita in D minor for solo violin (#BWV1004)">

    <!-- https://realfavicongenerator.net/ -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Include Handlebars from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <!-- moment -->
    <script src="https://cdn.jsdelivr.net/npm/moment@latest/moment.min.js"></script>

    <style>
        table.table-fit {
            width: auto !important;
            table-layout: auto !important;
            margin: auto;
        }

        table.table-fit thead th,
        table.table-fit tfoot th {
            width: auto !important;
        }

        table.table-fit tbody td,
        table.table-fit tfoot td {
            width: auto !important;
        }

        /* table head */
        thead>tr>th:not(:first-child) {
            border-left: .5px solid gray;
        }

        thead>tr>th:nth-child(4),
        thead>tr>th:nth-child(5) {
            white-space: nowrap;
        }

        thead>tr>th.sortable>span {
            float: right;
        }

        thead>tr>th:not(.sortable)>span:last-child {
            display: none;
        }

        thead>tr>th.sortable>span {
            position: relative;
            min-width: 2rem;
        }

        thead>tr>th.sortable>span::after {
            display: inline-block;
            content: '';
            background-image: url(svg/_sort-undefined.svg);
            background-size: 22px 22px;
            height: 22px;
            width: 22px;
            top:0;
            right:0; 
            position: absolute;
        }

        thead>tr>th.sortable.sorted_asc>span::after {
            background-image: url(svg/_sort-asc.svg);
            opacity: 1;
        }

        thead>tr>th.sortable.sorted_desc>span::after {
            background-image: url(svg/_sort-desc.svg);
            opacity: 1;
        }

        /* table body */
        tbody>tr>td:nth-child(2) {
            font-family: var(--bs-font-monospace) !important;
            font-size: 10pt;
            max-width: 4rem;
            overflow-x: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        tbody>tr>td:nth-child(3),
        tbody>tr>td:nth-child(4) {
            white-space: nowrap;
        }

        tbody>tr>td:nth-child(5) {
            font-style: italic;
        }

        tbody>tr>td:nth-child(3),
        tbody>tr>td:nth-child(6),
        tbody>tr>td:nth-child(7) {
            font-family: var(--bs-font-monospace) !important;
        }
    </style>

</head>

<body id="body" class="d-flex flex-column">
    <main id="perfContainer" class="container-fluid">
        <header class="fixed-top p-2" style="background-color: #f0f0f0; height: 6rem">
            <button id="go-back" type="button" class="btn btn-light" style="float:right"><img src="svg/go-back-arrow-svgrepo-com.svg" style="width:32px;height:auto;"></button>
            <h1>Performers</h1>
            <p>Meters were read on 8 April 2023</p>
        </header>
        <div id="perfContainerRow" class="row" style="margin-top: 6rem;">
            <div id="perfContainerCol" class="col">
                <table id="theTable" class="table table-fit table-responsive table-striped table-hover table-sm ">
                    <thead>
                        <tr style="font-size:smaller">
                            <!-- th scope="col">#</!-->
                            <th scope="col" class="text-start sortable"             >Performer    <span>&nbsp;</span></th>
                            <th scope="col" class="text-center"                     >YT           <span>&nbsp;</span></th>
                            <th scope="col" class="text-center sortable"            >&nbsp;       <span>&nbsp;</span></th>
                            <th scope="col" class="text-center sortable" colspan="2">Published on <span>&nbsp;</span></th>
                            <th scope="col" class="text-center sortable"            >Views        <span>&nbsp;</span></th>
                            <th scope="col" class="text-end sortable"               >Monthly      <span>&nbsp;</span></th>
                        </tr>
                    </thead>
                    <tbody id="theBody">
                    </tbody>
                </table>
            </div>
        </div>
    </main>


    <script id="artist-template" type="text/x-handlebars-template">{{#each this}}        
<tr>
<!-- th scope="row">{{@index}}</!-->
<th><a href={{thisUrl}}>{{hideMe fullname}}</a></th>
<td class="text-center"><a href={{v.youtubeUrl}} target={{v.id}}>{{v.id}}</a></td>
<td class="text-end">{{v.length}}</td>
<td class="text-end" data-timestamp="{{dateFormat v.publishedMoment "YYMM"}}">{{dateFormat v.publishedMoment "MMMM YYYY"}}</td>
<td>{{humanize v.durationMoment}}</td>
<td class="text-end" data-number="{{v.views}}">{{numberFormat v.views}}</td>
<td class="text-end" data-number="{{v.viewsPerMonth}}">{{numberFormat v.viewsPerMonth}}</td>
</tr>{{/each}}</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@latest/moment.min.js"></script>

    <script async type="module">
        import { loadArtists } from "/js/_artists2.js"

        document.getElementById("go-back").addEventListener("click", () => {
            history.back();
        });

        const ff = new Intl.NumberFormat()

        Handlebars.registerHelper('dateFormat', function (object, formatting) {
            return object.format(formatting)
        })
        Handlebars.registerHelper('humanize', function (object) {
            return object.humanize()
        })
        Handlebars.registerHelper('numberFormat', function (object) {
            return ff.format(object)
        })
        Handlebars.registerHelper('hideMe', function (object) {
            return object === "Christophe Thiebaud" ? "Moi" : object
        })

        const source = document.getElementById("artist-template").innerHTML;
        const template = Handlebars.compile(source);

        loadArtists().then((artists) => {
            const sorted = artists.sort((a, b) => b['▶'].viewsPerMonth - a['▶'].viewsPerMonth)

            const bodyContent = template(sorted)
            theBody.innerHTML = bodyContent

            document.querySelector('#theTable > thead > tr > th:last-child').classList.add('sorted_asc')
        })

    </script>

    <script>
        window.onload = function () {
            document.querySelectorAll('th:nth-child(1), th:nth-child(3), th:nth-child(4), th:nth-child(5), th:nth-child(6)').forEach((element) => { // Table headers
                element.addEventListener('click', function () {
                    let table = this.closest('table');

                    // If the column is sortable
                    if (this.querySelector('span')) {
                        let previousOrder = undefined
                        if (element.classList.contains("sorted_asc")) {
                            previousOrder = 'asc'
                        } if (element.classList.contains("sorted_desc")) {
                            previousOrder = 'desc'
                        }
                        let separator = '-----'; // Separate the value of it's index, so data keeps intact

                        let value_list = {}; // <tr> Object
                        let obj_key = []; // Values of selected column

                        let string_count = 0;
                        let number_count = 0;

                        const cell_index = element.cellIndex < 3 ? element.cellIndex : element.cellIndex + 1

                        // <tbody> rows
                        table.querySelectorAll('tbody tr').forEach((line, index_line) => {
                            // Value of each field
                            let key = line.children[cell_index].textContent.toUpperCase();

                            // Check if value is date, numeric or string
                            if (line.children[cell_index].hasAttribute('data-timestamp')) {
                                // if value is date, we store it's timestamp, so we can sort like a number
                                key = line.children[cell_index].getAttribute('data-timestamp');
                            }
                            else if (line.children[cell_index].hasAttribute('data-number')) {
                                // if value is date, we store it's timestamp, so we can sort like a number
                                key = line.children[cell_index].getAttribute('data-number');
                            }
                            else if (key.replace('-', '').match(/^[0-9,.]*$/g)) {
                                number_count++;
                            }
                            else {
                                string_count++;
                            }

                            value_list[key + separator + index_line] = line.outerHTML.replace(/(\t)|(\n)/g, ''); // Adding <tr> to object
                            obj_key.push(key + separator + index_line);
                        });
                        if (string_count === 0) { // If all values are numeric
                            obj_key.sort(function (a, b) {
                                return a.split(separator)[0] - b.split(separator)[0];
                            });
                        }
                        else {
                            obj_key.sort();
                        }

                        table.querySelectorAll('thead tr th ').forEach((line, index_line) => {
                            line.classList.remove("sorted_asc")
                            line.classList.remove("sorted_desc")
                        })

                        if (typeof previousOrder === 'undefined') {
                            element.classList.add("sorted_desc")
                        } else if (previousOrder === 'desc') {
                            obj_key.reverse();
                            element.classList.add("sorted_asc")
                        } else if (previousOrder === 'asc') {
                            element.classList.add("sorted_desc")
                        } else {
                            throw Error('non si può')
                        }

                        let html = '';
                        obj_key.forEach(function (chave) {
                            html += value_list[chave];
                        });
                        table.getElementsByTagName('tbody')[0].innerHTML = html;
                    }
                });
            });
        }
    </script>

</body>

</html>