<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DJBNRY1Z9M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-DJBNRY1Z9M');
    </script>
    <meta charset="utf-8">
    <!-- meta name="viewport" content="width=device-width, initial-scale=1" -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="keywords" content="Bach, JSBach, J.S. Bach, BWV1004, BWV 1004, Partita, 2nd Partita, Ciaconna, Chaconne">
    <meta name="author" content="Christophe Thiebaud">

    <!-- HTML Meta Tags -->
    <title>Ciaccona Performers</title>
    <meta name="description" content="Performers of Ciaccona from Johann Sebastian Bach's Partita in D minor for solo violin (#BWV1004)">

    <!-- https://realfavicongenerator.net/ -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Include Handlebars from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <!-- moment -->
    <script src="https://cdn.jsdelivr.net/npm/moment@latest/moment.min.js"></script>

    <script>
        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop)
        })
    </script>

    <script type="module">
    </script>

</head>

<body id="body" class="d-flex flex-column">
    <main id="perfContainer" class="container-fluid">
        <h1>Performers</h1>
        <div id="perfContainerRow" class="row">
            <div id="perfContainerCol" class="col">
                <table id="theTable" class="table table-responsive table-striped table-hover table-sm ">
                    <thead>
                        <tr>
                            <!-- th scope="col">#</!-->
                            <th scope="col">Performer</th>
                            <th scope="col">Video</th>
                            <th scope="col" class="text-end">Published</th>
                            <th scope="col"></th>
                            <th scope="col" class="text-end">Total Views</th>
                            <th scope="col" class="text-end">View per Month</th>
                        </tr>
                    </thead>
                    <tbody id="theBody">
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script id="artist-template" type="text/x-handlebars-template">{{#each this}}        
<tr>
<!-- th scope="row">{{@index}}</!-->
<td>{{fullname}}</td>
<td><a href={{v.youtubeUrl}} target={{v.id}}>{{v.id}}</a></td>
<td class="text-end">{{dateFormat v.publishedMoment "MMMM YYYY"}}</td>
<td>({{humanize v.durationMoment}})</td>
<td class="text-end">{{numberFormat v.views}}</td>
<td class="text-end">{{numberFormat v.viewsPerMonth}}</td>
</tr>{{/each}}
</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@latest/moment.min.js"></script>

    <script async type="module">
        import Α from "/js/_jquery-zero.js"
        import { loadArtists } from "/js/_artists2.js"

        const ff = new Intl.NumberFormat('en-US')

        Handlebars.registerHelper('dateFormat', function (object, formatting) {
            return object.format(formatting)
        })
        Handlebars.registerHelper('humanize', function (object, qwe) {
            return object.humanize()
        })
        Handlebars.registerHelper('numberFormat', function (object, qwe) {
            return ff.format(object)
        })

        const source = document.getElementById("artist-template").innerHTML;
        const template = Handlebars.compile(source);

        loadArtists().then((artists) => {
            const sorted = artists.sort((a, b) => b['▶'].viewsPerMonth - a['▶'].viewsPerMonth)

            const bodyContent = template(sorted)
            theBody.innerHTML = bodyContent
        })

    </script>

</body>

</html>