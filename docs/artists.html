<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DJBNRY1Z9M"></script>
    <script type="module">
        import config from "/js/config.js?v=0.9.7"

        if (!config.incognito) {
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());

            gtag('config', 'G-DJBNRY1Z9M');
        }
    </script>
    <meta charset="utf-8">
    <!-- meta name="viewport" content="width=device-width, initial-scale=1" -->
    <!-- meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="keywords" content="Bach, JSBach, J.S. Bach, BWV1004, BWV 1004, Partita, 2nd Partita, Ciaconna, Chaconne">
    <meta name="author" content="Christophe Thiebaud">

    <!-- HTML Meta Tags -->
    <title>Ciaccona - Artists</title>
    <meta name="description" content="32 + 1 performances of Johann Sebastian Bach's Ciaccona from Partita in D minor for solo violin BWV1004">

    <!-- try to convince browser to reload as much as possible -->
    <!-- https://stackoverflow.com/a/26818602/1070215 -->
    <meta http-equiv="cache-control" content="no-cache, must-revalidate, post-check=0, pre-check=0" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <!-- https://realfavicongenerator.net/ -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Facebook Meta Tags -->
    <meta property="fb:app_id" content="176898451849553">
    <meta property="og:locale" content="en_GB" />
    <meta property="og:site_name" content="ciaccona.cthiebaud.com" />
    <meta property="og:url" content="https://ciaccona.cthiebaud.com/artists.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Ciaccona">
    <meta property="og:description" content="32 + 1 performances of Johann Sebastian Bach's Ciaccona from Partita in D minor for solo violin BWV1004">
    <meta property="og:image" content="https://ciaccona.cthiebaud.com/logo5.jpg" />
    <meta property="og:image:url" content="https://ciaccona.cthiebaud.com/logo5.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="2400" />
    <meta property="og:image:height" content="1256" />

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@cthiebaud">
    <meta property="twitter:domain" content="ciaccona.cthiebaud.com">
    <meta property="twitter:url" content="https://ciaccona.cthiebaud.com/artists.html">
    <meta name="twitter:title" content="Ciaccona - Artists">
    <meta name="twitter:description" content="32 + 1 performances of Johann Sebastian Bach's Ciaccona from Partita in D minor for solo violin BWV1004">
    <meta name="twitter:image" content="https://ciaccona.cthiebaud.com/logo5.jpg">

    <!-- Apple iOS "Add to Home Screen" HTML meta tags https://gist.github.com/miguelmota/b874f287a77d96034b26a68ab56280f5 -->
    <!-- meta name="viewport" content="width=device-width, initial-scale=1" / -->
    <meta name="application-name" content="Ciaccona" />
    <meta name="apple-mobile-web-app-title" content="Ciaccona" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <!-- link rel="apple-touch-icon" href="/icon.png" / -->

    <!-- video player -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@latest/dist/plyr.css">
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">

    <!-- early scripts -->

    <script>
        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop)
        })
        let test = params.test ?? undefined
        let coerceArtist = params.a ?? undefined
        let coerceVariation = params.v ?? undefined
        let shuffle = params.shuffle ?? undefined
        if (typeof shuffle !== 'undefined' && (shuffle === 'false' || shuffle === '0' || !shuffle)) {
            shuffle = false
        } else {
            shuffle = true
        }

        // https://css-tricks.com/the-trick-to-viewport-units-on-mobile/
        function theTrickToViewportUnitsOnMobile(log) {
            if (log) console.log('window.innerWidth', window.innerWidth, 'window.innerHeight', window.innerHeight)

            const vh = window.innerHeight * 0.01
            const vw = window.innerWidth * 0.01

            // set the value in custom properties to the root of the document
            document.documentElement.style.setProperty('--vh', `${vh}px`)
            document.documentElement.style.setProperty('--vw', `${vw}px`)
        }

        theTrickToViewportUnitsOnMobile(true)

        // brick width
        function calcBrickWidth() {
            const containerWidth = document.getElementById('grid').getBoundingClientRect().width
            const gutter_size = containerWidth / 80;
            const gridBricksPerRow = 1 + Math.floor(containerWidth / 400)
            const gridBricksWidth = (containerWidth - (gridBricksPerRow - 1) * gutter_size) / gridBricksPerRow
            const gridBricksDoubleWidth = 2 * gridBricksWidth + gutter_size - .2
            const gridBrickPercentageWidth = 100 * gridBricksWidth / containerWidth
            const gridBrickDoublPercentageWidth = 100 * gridBricksDoubleWidth / containerWidth
            const gridBricksHeight = gridBricksWidth / 1.91;
            const gridBricksDoubleHeight = gridBricksHeight * 2 + gutter_size - .2

            document.documentElement.style.setProperty('--gbw', `${gridBrickPercentageWidth}%`)
            document.documentElement.style.setProperty('--gbh', `${gridBricksHeight}px`)
            document.documentElement.style.setProperty('--2gbw', `${gridBrickDoublPercentageWidth}%`)
            document.documentElement.style.setProperty('--2gbh', `${gridBricksDoubleHeight}px`)
        }

        window.addEventListener("DOMContentLoaded", (event) => {
            calcBrickWidth()
        }, { once: true });

        window.addEventListener('resize', /*lodash.debounce(*/() => { // debounce conflicts with Packery own debounce
            theTrickToViewportUnitsOnMobile()
            calcBrickWidth()
        }/* , 750) */)
    </script>

    <style>
        #gridContainerCol #grid .grid-artist {
            align-items: flex-end;
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            transition: background-image 0.5s linear;
            /*border-style: solid;
            border-width: 1.5px !important; */
            display: flex;
            font-size: 1.4rem;
            justify-content: space-between;
            padding: 0.4rem;
            text-align: center;
            visibility: inherit;
            width: var(--gbw, 100%);
            height: var(--gbh, 12rem);
            padding: 0;
            margin: 0;
            border: 1px white solid;
            border-radius: 0 6rem 6rem 0;
            position: absolute;
        }

        .large .handle {
            display: none;
        }

        .handle {
            cursor: grab;
            font-size: 12pt;
            font-family: var(--bs-font-monospace) !important;
            background-image: url(svg/cursor-hand-grab-svgrepo-com.svg);
            background-repeat: no-repeat;
            background-size: cover;
            width: 3rem;
            height: 3rem;
            color: #d3d3d3;
            font-size: 12px;
            line-height: 4rem;
            padding-left: .3rem;
            /* 
            background-color: black;
            border-radius: 0 2rem 0 0;
            padding: .4rem .6rem 0 .3rem;
            */
        }

        .puzzle {
            cursor: pointer;
            background-image: url(svg/puzzle-svgrepo-com.svg);
            background-repeat: no-repeat;
            background-size: cover;
            width: 3rem;
            height: 3rem;
            position: relative;
            right: 0;
            top: 0;
            bottom: 0;
            margin-top: auto;
            margin-bottom: auto;
        }

        .large {
            width: var(--2gbw, 200%) !important;
            height: var(--2gbh, 24rem) !important;
            border-radius: 0 12rem 12rem 0 !important;
        }

        .gutter-sizer {
            width: 1.25%;
        }
    </style>

    <script type="module">
        import { count } from "/js/count.js?v=0.9.7"

        count('artists', undefined, test)
    </script>

    <!-- google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&display=swap" rel="stylesheet">

    <!-- my styles -->
    <link href="index.css?v=0.9.7" rel="stylesheet">
</head>

<body id="body" class="artists no-vid d-flex flex-column">
    <main id="gridContainer" class="container-xxl flex-shrink-0">
        <div id="gridContainerRow" class="row justify-content-end" style="margin:0"> <!--  -->
            <div id="gridContainerCol" class="col">
                <button id="go-back" type="button" class="btn btn-light m-0 p-0" style="float:right; position: absolute; right:0; top:0; z-index: 2;">
                    <img src="svg/close-circle-svgrepo-com.svg" style="width:32px;height:auto;">
                </button>
                <div id="grid" style="color:white">
                    <div class="gutter-sizer"></div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/draggabilly@3.0.0/dist/draggabilly.pkgd.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/packery@2.1.2/sandbox/css/basics.min.css">
    <script src="https://cdn.jsdelivr.net/npm/packery@2.1.2/dist/packery.pkgd.min.js"></script>

    <script async type="module">
        /* import jquery from 'https://cdn.jsdelivr.net/npm/jquery@3.6.4/+esm'
        import packeryLayout from 'https://cdn.jsdelivr.net/npm/packery@2.1.2/+esm'
        import Draggabilly from 'https://cdn.jsdelivr.net/npm/draggabilly@3.0.0/+esm' */
        import { loadArtists } from "/js/artists.js?v=0.9.7"
        import { shuffleArray } from "/js/utils.js?v=0.9.7"

        const bg = (a, v) => `url('artists/${a}/${a}-${v}.jpg')`

        loadArtists().then((artists) => {

            const grid = document.getElementById('grid')
            let v = 0
            if (coerceArtist) {
                for (let v = 0; v <= 1 + 32 + 1; v++) {
                    console.log(coerceArtist, v)
                    grid.innerHTML += `
<div class="grid-artist draggable" data-a="${coerceArtist}" data-v="${coerceVariation || v}" style="background-image: ${bg(coerceArtist, coerceVariation || v)}">
  <!-- div>${artists.getArtistFromNameNoSpaceLowercaseNoDiacritics(coerceArtist).fullname}</!-->
  <div class="handle"></div>
  <div class="puzzle flex-shrink-1"></div>
</div>`
                }
            } else {
                const qwe = shuffle ? shuffleArray(artists.artists) : artists.artists
                qwe.forEach(a => {
                    if (a.v.still || a.fullnameNoSpaceLowercaseNoDiacritics === 'moi') return
                    console.log(a)
                    let bgFull
                    if (a.fullnameNoSpaceLowercaseNoDiacritics === 'moi') {
                        bgFull = `background-color: #28282b;`
                    } else {
                        bgFull = `background-image: ${bg(a.fullnameNoSpaceLowercaseNoDiacritics, coerceVariation || v)};`
                    }
                    // console.log(a)
                    grid.innerHTML += `
<div class="grid-artist draggable" data-a="${a.fullnameNoSpaceLowercaseNoDiacritics}" data-v="${coerceVariation || v}" style="${bgFull}">
    <div class="handle"></div>
    <div style="visibility:hidden">${a.fullname}</div>
    <div class="puzzle flex-shring-0"></div>
</div>`
                    v++
                })
            }

            /* setTimeout(() => { */

            var $grid = $('#grid').packery({
                itemSelector: ".grid-artist",
                percentPosition: true,
                initLayout: false,
                gutter: '.gutter-sizer',
                resize: true
            })
            // make all grid-items draggable
            $grid.find('.grid-artist').each(function (i, gridItem) {
                var draggie = new Draggabilly(gridItem, {
                    handle: '.handle'
                });
                // bind drag events to Packery
                $grid.packery('bindDraggabillyEvents', draggie);
            });
            function orderItems(reorder) {
                var itemElems = $grid.packery('getItemElements');
                $(itemElems).each(function (i, itemElem) {
                    // console.log(i, itemElem)
                    const v = reorder || typeof itemElem.dataset.v === 'undefined' ? i : itemElem.dataset.v
                    if (itemElem.dataset.a) {
                        let bgFull
                        const a = itemElem.dataset.a
                        if (a === 'moi') {
                            bgFull = { 'background-color': '#28282b' }
                        } else {
                            bgFull = { 'background-image': bg(itemElem.dataset.a, v) }
                        }
                        $(itemElem).css(bgFull).find('.handle').text(v)
                    } else {
                        $(itemElem).find('.handle').text(v)
                    }
                });
            }
            orderItems()
            $grid.on('layoutComplete', function () {
                console.log("Packery layout complete");
            })
            $grid.on('dragItemPositioned', function () {
                orderItems(true)
            });

            $grid.on('fitComplete', function (item) {
                orderItems()
                $grid.packery('shiftLayout');
            })

            $grid.packery()

            document.getElementById("go-back").addEventListener("click", () => {
                window.location = document.referrer
            });

            // https://codepen.io/desandro/pen/WxjJJW/
            $grid.on('click', '.grid-artist .puzzle', function (event) {
                event.stopPropagation()
                event.preventDefault()
                const target = event.currentTarget.parentNode;
                window.location = `puzzle.html?a=${target.dataset.a}&v=${target.dataset.v}`
            })
            function removeLarges() {
                const $wereLarges = $('.grid-artist.large');
                $wereLarges.each((index, wasLarge) => {
                    wasLarge.classList.remove('large')
                    let item = $grid.packery('getItem', wasLarge)
                    if (item && item.previousPosition) {
                        // fit back in previous position
                        console.log('about to fit')
                        $grid.packery('fit', wasLarge, item.previousPosition.x, item.previousPosition.y);
                        // remove previous position
                        delete item.previousPosition;
                    }
                })
            }
            $('body').on('click', function (event) {
                event.stopPropagation()
                event.preventDefault()
                removeLarges()
            })
            $grid.on('click', '.grid-artist', function (event) {
                event.stopPropagation()
                event.preventDefault()
                var target = event.currentTarget;
                var targetWasLarge = target.classList.contains('large');
                removeLarges()
                if (!targetWasLarge) {
                    target.classList.add('large');
                    var item = $grid.packery('getItem', target)
                    // save previous position
                    item.previousPosition = {
                        x: item.position.x,
                        y: item.position.y
                    };
                    console.log('about to fit')
                    $grid.packery('fit', target);
                }
            });


        })
        /* }, 1000) */

    </script>

</body>

</html>