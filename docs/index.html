<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <!-- meta name="viewport" content="width=device-width, initial-scale=1" -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <meta name="keywords" content="Bach, JSBach, BWV1004, Partita, Ciaconna, Chaconne">
    <meta name="author" content="Christophe Thiebaud">

    <!-- HTML Meta Tags -->
    <title>Ciaccona</title>
    <meta name="description" content='The "Tribune des Critiques de Disques" of the Ciaccona (/Chaconne) of the 2nd Partita BWV 1004 by JS Bach'>

    <!-- https://realfavicongenerator.net/ -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Facebook Meta Tags -->
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="ciaccona.cthiebaud.com" />
    <meta property="og:url" content="https://ciaccona.cthiebaud.com/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Ciaccona">
    <meta property="og:description" content="La Tribune des Critiques de Disques de la Ciaccona ou Chaconne de la 2ème Partita BWV 1004 de JS Bach">
    <meta property="og:image" content="https://ciaccona.cthiebaud.com/logo3.jpg" />
    <meta property="og:image:url" content="https://ciaccona.cthiebaud.com/logo3.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="2400" />
    <meta property="og:image:height" content="1260" />

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@cthiebaud">
    <meta property="twitter:domain" content="ciaccona.cthiebaud.com">
    <meta property="twitter:url" content="https://ciaccona.cthiebaud.com/">
    <meta name="twitter:title" content="Ciaccona">
    <meta name="twitter:description" content="La Tribune des Critiques de Disques de la Ciaccona ou Chaconne de la 2ème Partita BWV 1004 de JS Bach">
    <meta name="twitter:image" content="https://ciaccona.cthiebaud.com/logo3.jpg">

    <!-- video player -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@latest/dist/plyr.css">
    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <!-- early scripts -->

    <script>
        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });
        // get the value of "some_key" in eg "https://example.com/?some_key=some_value"
        let videoId = params.yt; // "some_value"
        const logo = params.logo; // "some_value"
        if (logo === "true") {
            videoId = undefined
        }
    </script>

    <script src="/resizeSVGs.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/lodash@latest/lodash.min.js"></script>
    <script>
        // <!-- CSS variable for dimensions -->
        const afterResizeWindow = () => {
            // https://css-tricks.com/the-trick-to-viewport-units-on-mobile/
            const vh = window.innerHeight * 0.01
            const vw = window.innerWidth * 0.01

            // Then we set the value in the --vh custom property to the root of the document
            document.documentElement.style.setProperty('--vh', `${vh}px`)
            document.documentElement.style.setProperty('--vw', `${vw}px`)
        }
        afterResizeWindow()
        window.addEventListener('resize',
            _.debounce(() => {
                afterResizeWindow()
            }, 750)
        );

        // <!-- resize each SVG to its bounding box -->
        window.addEventListener('load', (event) => {
            resizeSVGs(
                document.querySelectorAll('#grid object'),
                fullWidthChecked ? false : true, // true: honor X offset to hide clef signature, false: no offset
                (o) => {
                    if (!videoId) {
                        $(o).parent().css({ visibility: "visible" })
                    } // else, will be set to visible when video player is itself visible
                }, () => {
                    if (!videoId) {
                        hideLoading()
                    } // else, will be set to visible when video player is itself visible
                })
        });
    </script>

    <!-- google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&display=swap" rel="stylesheet">

    <!-- -->
    <style>
        body {
            /* https://css-tricks.com/the-trick-to-viewport-units-on-mobile/ */
            /* fallback for browsers that do not support custom properties */
            height: 100vh;
            /* custom properties */
            height: calc(var(--vh, 1vh) * 100);
        }

        .fullscreen {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            height: calc(var(--vh, 1vh) * 100);
            width: calc(var(--vw, 1vh) * 100);
        }

        #loading .spinner-border {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            right: 0;
            margin: auto;
            width: 5rem;
            height: 5rem;
            color: #5b7085;
            /* Silver Blueberry // #36454F; /* Charcoal */
            border-width: .5rem;
        }

        .container-fluid {
            height: calc(var(--vh, 1vh) * 100);
        }

        a {
            text-decoration: none;
        }

        #gridContainer {
            padding: .5rem 0;
        }

        #gridContainerCol {
            margin: 0;
            padding: 0;
        }

        #gridContainerCol.push2right {
            max-width: min(var(--vw, 1vw) * 100, 23.5rem);
            height: calc(var(--vh, 1vh) * 100 - 57px) !important;
            overflow-y: scroll;
            margin: 0;
            padding: 0;
        }

        .fullwidth {
            max-width: 100% !important;
            width: 100% !important;
        }

        .grid-brick {
            /* display: grid; */
            font-size: 1.4rem;
            width: min(var(--vw, 1vw) * 100, 23.5rem);
            /* width: 100%; */
            height: 6rem;
            padding: .4rem;
            border-style: dashed;
            border-width: 4px !important;
            cursor: pointer;
        }

        .grid-brick:not(.playing) {
            border-color: transparent !important;
        }

        .grid-brick.playing .brick {
            border-radius: 0 !important;
        }

        .grid-brick.playing .score {
            border-radius: 0 !important;
            width: 100% !important;
        }

        .grid.playing object {
            border-radius: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }

        .grid-brick.playing .brick :not(:first-child) {
            display: none !important;
        }

        .grid-brick.Δ {
            background-color: rgba(128, 128, 128, .3);
        }

        .brick {
            border-radius: 0 3rem 3rem 0;
            width: 100%;
            height: 100%;
        }

        .score {
            position: relative;
            height: 5rem;
            overflow: hidden;
            border-radius: 0 3rem 3rem 0;
        }

        .score object {
            background-color: rgba(255, 255, 255, .8);
            height: 100%;
            background-clip: padding-box;
            position: absolute;
            display: block;
        }

        div.siegel {
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center center;
            background-color: transparent;
        }

        div.siegel#logoLeft {
            background-image: url('svg/Bach_Seal_full_left_120x120.svg');
            left: -111vw;
        }

        div.siegel#logoRight {
            background-image: url('svg/Bach_Seal_full_right_120x120.svg');
            left: +111vw;
        }

        .glowing_bubble_siegel {
            width: 100%;
            margin: 0 .6rem;
            background-image: url('svg/Bachsiegel_glowing_bubble.svg');
            background-size: contain;
            background-repeat: no-repeat;
            background-color: #ddd;
            background-position-x: center;
            background-size: 60%;
            background-position-y: 50%;
            border-radius: 1rem;
        }

        .magnificient-card {
            font-family: 'Cinzel', serif;
            font-size: 24px;
            outline: 1px solid gray;
            outline-offset: -2px;
            background-clip: content-box;
            text-align: center;
            background-color: rgba(255, 255, 255, .5);
            border-radius: 1rem;
            color: #121212;
        }

        span.Δ {
            font-family: 'Cinzel', serif;
            font-size: smaller;
            float: left;
            padding-right: .3rem;
            position: relative;
            background-color: rgba(0, 0, 0, .25);
            border-bottom-right-radius: 1rem;
            color: rgba(255, 255, 255, .75);
            padding: 0 .4rem 0 .2rem;
        }

        .video-container {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            right: 0;
            padding: 0;
            opacity: 1;
        }

        #playerWrapper>div>div.plyr__controls>div.plyr__controls__item.plyr__menu {
            display: none;
        }

        .plyr:not(.plyr--playing) .plyr__video-embed {
            filter: blur(.8rem);
        }

        /* https://stackoverflow.com/a/60192837/1070215 */
        .plyr .plyr__video-embed {
            position: relative;
            overflow: hidden;
            width: calc(var(--vw, 1vw) * 100);
            height: calc(var(--vh, 1vh) * 100);
            pointer-events: none;
        }

        .plyr .plyr__video-embed iframe {
            position: absolute;
            top: 50%;
            left: 50%;
            width: calc(var(--vw, 1vw) * 100);
            height: calc(var(--vh, 1vh) * 100);
            transform: translate(-50%, -50%);
        }

        @media (min-aspect-ratio: 16/9) {
            .plyr .plyr__video-embed iframe {
                /* height = 100 * (9 / 16) = 56.25 */
                height: 56.25vw;
            }
        }

        @media (max-aspect-ratio: 16/9) {
            .plyr .plyr__video-embed iframe {
                /* width = 100 / (9 / 16) = 177.777777 */
                width: calc(var(--vh, 1vh) * 177.78);
            }
        }

        iframe {
            display: block;
            margin: 0 auto;
        }

        li a.dropdown-item {
            max-height: 32px;
        }

        li a.dropdown-item img {
            height: 40px;
            overflow-y: visible;
        }

        li a.dropdown-item div {
            margin-left: 1rem;
        }

        .d-flex[style*="display:none"],
        .d-flex[style*="display: none"] {
            display: none !important;
        }
    </style>
</head>

<body class="d-flex flex-column">

    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="facebook" viewBox="0 0 16 16">
            <path
                d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
        </symbol>
        <symbol id="instagram" viewBox="0 0 16 16">
            <path
                d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z" />
        </symbol>
        <symbol id="twitter" viewBox="0 0 16 16">
            <path
                d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" />
        </symbol>

        <symbol id="youtube" viewBox="48.863006591796875, 79.2229995727539, 202.2743682861328, 141.55401611328125">
            <path fill="white" d="M97.437 98.708h102.584v93.685H97.437z" opacity="1" />
            <path fill="red"
                d="M149.938 79.223s-63.22 0-79.086 4.123c-8.496 2.374-15.492 9.37-17.866 17.99-4.123 15.867-4.123 48.727-4.123 48.727s0 32.984 4.123 48.601c2.374 8.62 9.245 15.491 17.866 17.865 15.992 4.248 79.086 4.248 79.086 4.248s63.344 0 79.21-4.123c8.621-2.373 15.492-9.12 17.74-17.865 4.249-15.742 4.249-48.601 4.249-48.601s.125-32.985-4.248-48.852c-2.25-8.62-9.12-15.491-17.74-17.74-15.867-4.373-79.211-4.373-79.211-4.373zm-20.116 40.48 52.6 30.36-52.6 30.234v-60.594z" />

        </symbol>

        <symbol id="youtubeBlack" viewBox="48.863006591796875, 79.2229995727539, 202.2743682861328, 141.55401611328125">
            <path fill="white" d="M97.437 98.708h102.584v93.685H97.437z" opacity="1" />
            <path fill="black"
                d="M149.938 79.223s-63.22 0-79.086 4.123c-8.496 2.374-15.492 9.37-17.866 17.99-4.123 15.867-4.123 48.727-4.123 48.727s0 32.984 4.123 48.601c2.374 8.62 9.245 15.491 17.866 17.865 15.992 4.248 79.086 4.248 79.086 4.248s63.344 0 79.21-4.123c8.621-2.373 15.492-9.12 17.74-17.865 4.249-15.742 4.249-48.601 4.249-48.601s.125-32.985-4.248-48.852c-2.25-8.62-9.12-15.491-17.74-17.74-15.867-4.373-79.211-4.373-79.211-4.373zm-20.116 40.48 52.6 30.36-52.6 30.234v-60.594z" />

        </symbol>

        <symbol id="cthiebaud" viewBox="0 0 382.07 377.86">
            <path
                d="M93.832 377.709c-21.112-1.858-38.24-9.37-53.95-23.664-5.08-4.622-9.224-9.262-14.454-16.181C11.66 319.647 3.735 299.304.79 274.614c-.785-6.585-.79-6.7-.789-18.75.003-12.034.008-12.178.811-19.25 3.088-27.162 11.52-49.436 26.027-68.75 4.202-5.594 6.978-8.741 11.89-13.479 17.442-16.823 39.576-26.865 65.854-29.875 5.85-.67 10.164-.894 17.25-.894 9.42 0 16.454.707 24.524 2.466 2.82.615 3.248.657 3.133.31-.073-.222-.808-2.372-1.633-4.778-4.187-12.221-6.55-23.3-7.536-35.332-.432-5.27-.18-15.74.485-20.223 1.447-9.744 4.553-18.708 9.293-26.824 11.336-19.405 29.848-32.269 53.36-37.077C212.406.328 215.935.014 227.708 0c8.056-.01 11.212.083 14.75.434 23.78 2.357 41.102 9.522 53.015 21.929 10.091 10.51 15.863 23.818 18.161 41.875.522 4.103.544 5.271.632 33.812l.09 29.563h54.976v17.75h-55.028l.111 78.437c.072 55.82.184 79.52.389 82.188 1.086 14.195 2.866 22.98 6.152 30.37 2.643 5.944 6.677 10.315 11.136 12.067 2.737 1.075 4.1 1.263 8.153 1.125 11.535-.395 21.91-5.793 32.487-16.905l2.265-2.38 3.533 2.987c1.942 1.642 3.539 3.049 3.547 3.126.01.077-.962 1.315-2.157 2.75-16.583 19.923-33.949 32.172-52.226 36.84-4.974 1.27-10.298 1.895-16.134 1.895-16.34 0-27.51-5.106-34.278-15.67-4.183-6.53-7.249-19.946-8.558-37.455-.732-9.795-.872-26.123-.877-102.848v-76.598l-10.187.129c-13.124.166-16.41-.11-19.085-1.604-1.753-.979-2.074-2.279-1.236-4.993l.492-1.592 3.696-2.62c6.637-4.706 12.791-10.024 21.383-18.478l4.937-4.859v-10.644c0-16.29-.983-24.346-4.16-34.143-7.28-22.439-24.682-33.892-51.464-33.87-7.978.007-13.147.6-19.66 2.26-5.943 1.513-11.928 4.159-16.818 7.434-10.838 7.257-16.968 16.986-18.902 30.002-.625 4.201-.673 12.004-.105 16.998 1.433 12.613 5.504 26.432 12.315 41.8 1.289 3.228 1.01 3.115 3.833 4.632 11.49 6.172 20.256 13.867 24.914 21.869 2.144 3.682 3.66 7.467 4.592 11.455.745 3.19.8 3.74.815 8.17.016 4.73.012 4.76-.801 7.14-2.36 6.902-9.84 13.83-16.933 15.684-2.525.66-8.054.96-10.442.568-5.494-.903-10.021-3.568-14.239-8.38-2.43-2.773-4.1-5.546-5.127-8.512-.871-2.514-.981-3.274-1.309-9.048-.481-8.47-2.143-14.385-5.534-19.702-1.52-2.382-5.872-6.794-8.225-8.336-4.532-2.97-10.56-5.08-17.75-6.212-2.343-.368-4.284-.448-10.5-.43-7.485.023-7.703.038-11.875.825-18.364 3.466-32.456 14.023-43.75 32.775-8.038 13.347-12.957 28.758-14.804 46.378-.687 6.548-.612 22.714.134 29.326 2.29 20.27 8.313 37.366 18.691 53.049 4.014 6.065 7.612 10.522 12.222 15.138 11.714 11.732 24.718 18.367 40.907 20.874 4.318.668 14.628.946 18.775.505 24.96-2.652 47.668-18.625 68.178-47.955 1.274-1.821 2.374-3.312 2.444-3.312.113 0 7.341 4.198 7.53 4.374.043.04-1.181 2.587-2.72 5.661-12.237 24.456-26.382 43.31-42.746 56.98-12.74 10.64-27.745 18.024-43.11 21.215-7.002 1.453-10.677 1.812-19.376 1.892-4.33.04-8.38.027-9-.027z" />
        </symbol>
        <symbol id="github" viewBox="0 0 98 96">
            <path fill-rule="evenodd" clip-rule="evenodd"
                d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"
                fill="#24292f" />
        </symbol>
        <symbol id="external-link" viewBox="0 -256 1850 1850">
            <path fill="#d0d0d0"
                d="M1438.373 818.95v320q0 119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119 84.5-203.5t203.5-84.5h704q14 0 23 9t9 23v64q0 14-9 23t-23 9h-704q-66 0-113 47t-47 113v832q0 66 47 113t113 47h832q66 0 113-47t47-113v-320q0-14 9-23t23-9h64q14 0 23 9t9 23zm384-864v512q0 26-19 45t-45 19q-26 0-45-19l-176-176-652 652q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l652-652-176-176q-19-19-19-45t19-45q19-19 45-19h512q26 0 45 19t19 45z" />
        </symbol>

    </svg>

    <div id="videos-menu" class="btn-group">
        <span class="dropdown" style="position: absolute; left: 0; width: fit-content; background: transparent; z-index: 1001; border: none; margin: .5rem;">
            <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false"
                style="background: #00000040; border: none;">
                <svg width="32" height="32">
                    <g fill="red">
                        <use xlink:href="#youtube"></use>
                    </g>
                </svg>
            </a>

            <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink" style="padding-bottom: 0;">
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=mg9kT7XiLoU'"><img src="svg/violin.svg">
                        <div>Amandine Beyer</div>
                    </a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=Ilb3no_cwnI'">&nbsp; <div>Veronika Eberle</div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=r67BASAgP5Q'">&nbsp; <div>Isabelle Faust</div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=KgSKvOAJMb8'">&nbsp; <div>Midori Gotō</div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=ngjEVKxQCWs'">&nbsp; <div>Hilary Hahn</div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=XkfsGCIiHb4'">&nbsp; <div>Bella Hristova </div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=dyAcRqpjbqU'">&nbsp; <div>Lisa Jacobs</div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=NCTDf8dNT5s'">&nbsp; <div>Sigiswald Kuijken</div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=1HSJufg7I1I'">&nbsp; <div>Rachel Podger</div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=KWcGsRKbe-U'">&nbsp; <div>Virginie Robilliard</div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=59KFAY_qf-Q'">&nbsp; <div>Rachell Ellen Wong</div></a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=lxZqC_J0C74'"><img src="svg/guitar.svg"
                            style="top: -0.5rem; position: relative;">
                        <div>Petra Poláčková</div>
                    </a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=Jcy7E4uHYK8'">&nbsp; <div>Raphaella Smits</div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=oxWq93mlAyc'">&nbsp; <div>Andrea De Vitis</div></a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=Vslz1tDsaWw'">&nbsp; <div>Moi</div></a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=SzxzLtwK-eo'"><img src="svg/piano.svg"
                            style="top: -0.5rem; position: relative;">
                        <div>Chiara Massini</div>
                    </a>
                </li>
                <!-- no embedding :(
                    <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=ze_QPWuyZLo'">&nbsp; <div>Genzoh Takehisa</div></a></li>
                -->
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=KHwsHXtVWks'"><img src="svg/harp.svg"
                            style="top: -0.5rem; position: relative;">
                        <div>Anneleen Lenaerts</div>
                    </a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=P93o202UJRs'"><img src="svg/flute.svg"
                            style="top: -0.5rem; position: relative;">
                        <div>Marta Femenía</div>
                    </a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=BYg7Di8CH9w'"><img src="svg/marimba.svg"
                            style="top: -0.66rem; position: relative;">
                        <div>Mika Stoltzman</div>
                    </a></li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=5ITydjLkYUk'">&nbsp; <div>Yun Park</div></a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/'">
                        &nbsp;<div style="font-size:20pt; top: -0.5rem; position: relative;">🏠<!--∅--></div>
                    </a></li>
                <li style="background-color: lightgray; padding: 0.5rem 0;"><a class="dropdown-item d-flex justify-content-center" href="#" onclick="location = '/?logo=true'">
                        &nbsp;<img style="top: -0.5rem; position: relative;" src="svg/BachsiegelColorWheel.svg">
                    </a></li>
            </ul>
        </span>

    </div>

    <div id="config-menu" class="btn-group">
        <span class="dropdown" style="position: absolute; right: 0; width: fit-content; background: transparent; z-index: 1001; border: none; margin: .5rem; ">
            <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink2" data-bs-toggle="dropdown" aria-expanded="false"
                style="background: #00000040; border: none; font-size: 1.3rem;">
                ⚙
            </a>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink2">
                <form class="px-4 py-3">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck">
                        <label class="form-check-label align-top" for="dropdownCheck">
                            Full Score <span style="display: none; font-size:2rem;">𝄞</span>
                        </label>
                    </div>
                </form>
            </ul>
        </span>
    </div>

    <header style="display: none !important; z-index: 1000; background-color: #ffffff80; border-bottom: 1px solid #a0a0a080;"
        class="header fixed-top p-3 d-flex flex-wrap justify-content-between align-items-center">
        <ul class="nav col-md-4 flex-fill justify-content-end list-unstyled d-flex">
            <li class="ms-3">
                <a class="text-muted" target="github" href="https://github.com/cthiebaud/ciaccona">
                    <svg width="24" height="24" preserveAspectRatio="xMidYMid meet">
                        <use xlink:href="#github"></use>
                    </svg>
                </a>
            </li>
            <li class="ms-3">
                <a class="text-muted" target="twitter" href="https://twitter.com/cthiebaud">
                    <svg width="24" height="24" preserveAspectRatio="xMidYMid meet">
                        <use xlink:href="#twitter"></use>
                    </svg>
                </a>
            </li>
            <li class="ms-3">
                <a class="text-muted" target="instagram" href="https://www.instagram.com/cthiebaud/">
                    <svg width="24" height="24" preserveAspectRatio="xMidYMid meet">
                        <use xlink:href="#instagram"></use>
                    </svg>
                </a>
            </li>
            <li class="ms-3">
                <a class="text-muted" target="facebook" href="https://www.facebook.com/christophe.thiebaud">
                    <svg width="24" height="24" preserveAspectRatio="xMidYMid meet">
                        <use xlink:href="#facebook"></use>
                    </svg>
                </a>
            </li>
            <li class="ms-3">
                <a class="text-muted" target="youtube" href="https://www.youtube.com/channel/UCxt1pFJkKS3LlhmSsHCrZkg">
                    <svg width="34.286" height="24" preserveAspectRatio="xMidYMid meet">
                        <use xlink:href="#youtubeBlack"></use>
                    </svg>
                </a>
            </li>
        </ul>
    </header>

    <div id="logos">
        <div id="logoRight" class="fullscreen siegel" style="display:none;"></div>
        <div id="logoLeft" class="fullscreen siegel" style="display:none;"></div>
    </div>
    <div id="credits" class="container" style="opacity: 0">
    </div>

    <footer style="display: none !important; z-index: 1000; background-color: #ffffff80; border-top: 1px solid #a0a0a080;"
        class="footer mt-auto p-2 d-flex flex-wrap justify-content-center">
        <div class="ms-3 d-flex">
            <a class="text-muted" target="cthiebaud" href="https://cthiebaud.com/">
                <svg width="32" height="32" preserveAspectRatio="xMidYMid meet">
                    <use xlink:href="#cthiebaud"></use>
                </svg>
            </a>
        </div>
        <div class="ms-3" style="margin-top: auto;">
            <span class="text-muted" style="margin-top: auto;"><span>© 2023 Christophe Thiebaud</span></span>
        </div>
        <div class="ms-3" style="margin-top: auto;">
            <span class="font-monospace badge rounded-pill bg-primary">v0.15</span>
        </div>
    </footer>

    <div id="loading" class="fullscreen" style="z-index: 2000; background-color: #ffffff80;">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <main id="gridContainer" class="container-fluid flex-shrink-0" style="z-index: 999;position: absolute; top:0; left:0; padding-top: .5rem; padding-bottom: .5rem; height: 100%;">
        <div id="gridContainerRow" class="row justify-content-end" style="margin:0"> <!--  -->
            <div id="playerWrapper" class="col video-container" data-plyr-provider="youtube" data-plyr-embed-id="" style="visibility: hidden">
            </div>
            <div id="gridContainerCol" class="col" style="visibility: hidden"> <!--  -->
                <div id="grid">
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/isotope-layout@latest/dist/isotope.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/isotope-packery@latest/packery-mode.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bezier-easing@2.1.0/dist/bezier-easing.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@latest/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plyr@latest/dist/plyr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/imagesloaded@latest/imagesloaded.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>

    <script>
        const mapVideoId2ArtistName = {
            mg9kT7XiLoU: "Amandine Beyer",
            Ilb3no_cwnI: "Veronika Eberle",
            r67BASAgP5Q: "Isabelle Faust",
            KgSKvOAJMb8: "Midori Gotō",
            ngjEVKxQCWs: "Hilary Hahn",
            XkfsGCIiHb4: "Bella Hristova",
            dyAcRqpjbqU: "Lisa Jacobs",
            NCTDf8dNT5s: "Sigiswald Kuijken",
            _1HSJufg7I1I: "Rachel Podger",
            KWcGsRKbe_U: "Virginie Robilliard",
            _59KFAY_qf_Q: "Rachell Ellen Wong",
            lxZqC_J0C74: "Petra Poláčková",
            Jcy7E4uHYK8: "Raphaella Smits",
            oxWq93mlAyc: "Andrea De Vitis",
            SzxzLtwK_eo: "Chiara Massini",
            ze_QPWuyZLo: "Genzoh Takehisa",
            KHwsHXtVWks: "Anneleen Lenaerts",
            BYg7Di8CH9w: "Mika Stoltzman",
            _5ITydjLkYUk: "Yun Park",
            P93o202UJRs: "Marta Femenía",
            Vslz1tDsaWw: "Christophe Thiebaud",
        }

        let videoPromise
        let artist

        const initVideoTimings = (videoTimings) => {
            const initializeBarObject = (bar) => {
                if (!bar.m) {
                    bar.m = new moment(bar["Time Recorded"])
                }
                bar.duration = moment.duration(bar.m.diff(videoTimings.start))
                if (videoTimings.offset) {
                    bar.duration.add(videoTimings.offset)
                }
                if (videoTimings.adjust) {
                    bar.duration.subtract(videoTimings.adjust)
                }
                return bar
            }
            videoTimings.ciacconaStart = initializeBarObject({ m: videoTimings.start })
            for (let bar of videoTimings.bars) {
                initializeBarObject(bar)
            }
            // console.log(fm(videoTimings.start), fm(videoTimings.ciacconaStart.m), fm(videoTimings.bars[0].m))
        }

        if (videoId) {
            const videoIdNoHyphen = videoId.replace(/-/gi, '_')
            const videoIdNoHyphenNoStartingNumber = videoIdNoHyphen.replace(/^(\d.*)/i, '_$1')
            artist = mapVideoId2ArtistName[videoIdNoHyphenNoStartingNumber]
            const artistNoSpace = artist.replace(/\s/gi, '')
            const url = `timings/${artistNoSpace}-${videoId}.js`
            videoPromise = new Promise((resolve, reject) => {
                console.log('script loading', url)
                $.ajax({
                    url: url,
                    dataType: "script",
                })
                    .done(function () {
                        console.log("script loaded", url);
                        const qwe = eval(videoIdNoHyphenNoStartingNumber)
                        initVideoTimings(qwe)
                        resolve(qwe)
                    })
                    .fail(function () {
                        console.log("script loading error", url);
                        reject()
                    })
                    .always(function () {
                        console.log("script loading complete", url);
                    })
            })
        }

        // utilities
        const getCookie = (cookieName) => {
            const value = Cookies.get(cookieName)
            console.log("Cookie", cookieName, "is", value)
            return value
        }
        const setCookie = (cookieName, cookieValue) => {
            Cookies.set(cookieName, cookieValue, { expires: 2 })
            console.log("Cookie", cookieName, "set to", cookieValue)
        }
        const fm = (m) => m.format('h:mm:ss')
        const fd = (d) => {
            const m = moment(d.asMilliseconds())
            return m.format('mm:ss')
        }
        // end of utilities

        let fullWidthChecked = getCookie('fullscore')
        if (!fullWidthChecked || fullWidthChecked == 'false') {
            fullWidthChecked = false
        } else {
            fullWidthChecked = true
            $("#dropdownCheck").attr('checked', 'checked')
        }

        $("#dropdownCheck").on("click", function () {
            fullWidthChecked = !fullWidthChecked
            setCookie('fullscore', fullWidthChecked ? 'true' : 'false')
            if (fullWidthChecked) {
                $('#gridContainerCol').addClass('fullwidth')
                $('.grid-brick, .score').addClass('fullwidth')
            } else {
                $('#gridContainerCol').removeClass('fullwidth')
                $('.grid-brick, .score').removeClass('fullwidth')
            }
            $("#grid").isotope('layout')
        });                           
    </script>
    <script>

        let scrollIntoView = false

        const hideLoading = () => {
            $('#loading').animate({ 'opacity': 0 }, 500, () => {
                $('#loading').hide()
            })
        }

        if (logo === "true") {
            $('#gridContainerCol').css({ display: 'none' })
            $('#config-menu').hide()
            $('header.header').show()
            $('div.fullscreen.siegel#logoLeft').show().animate({ left: 0, opacity: 1 }, 2000)
            $('div.fullscreen.siegel#logoRight').show().animate({ left: 0, opacity: 1 }, 2000, undefined, () => {
                console.log('end of animation')
            })
            $('footer.footer').show()
            hideLoading()

        } else {
            $('header.header').hide()
            $('div.fullscreen.siegel#logoLeft').hide()
            $('div.fullscreen.siegel#logoRight').hide()
            $('footer.footer').hide()
        }
        let previousPlayOnBar = getCookie('previousPlayOnBar')
        if (!previousPlayOnBar) previousPlayOnBar = 0

        const variationsBars = [
        ]
        const index2duration = (i) => (i == 10 || i == 15 || i == 19 || i == 29) ? 4 : ((i == 8 || i == 30) ? 12 : 8)
        {
            let bar = 0
            for (let i = 0; i < 34; i++) {
                const duration = index2duration(i)
                variationsBars.push(bar)
                bar = bar + duration
            }
        }
        const variation2bar = (variation) => {
            return variationsBars[variation]
        }
        // https://code.tutsplus.com/the-binary-search-algorithm-in-javascript--cms-30003t
        function binaryRangeSearch(value, list, getValue) {
            if (typeof getValue === 'undefined') getValue = (x) => list[x]

            let low = 0;                  // left endpoint 
            let high = list.length - 1;   // right endpoint 
            let mid
            let minValue, maxValue

            while (low <= high) {
                mid = Math.floor((low + high) / 2);
                minValue = getValue(mid)
                maxValue = mid < list.length - 1 ? getValue(mid + 1) : Number.MAX_VALUE

                if (value < minValue) {
                    high = mid - 1;
                } else if (maxValue <= value) {
                    low = mid + 1;
                } else {
                    // console.log('bar', value, 'is in variation', mid)
                    return mid;
                }
            }
            return 0 // something is wrong, return first array element
        }
        const bar2variation = (bar) => {
            return binaryRangeSearch(bar, variationsBars)
        }

        if (!videoId) {
            $('#gridContainerCol').css({ visibility: 'visible' })
            $('.score').css({ visibility: "visible" })
        } else {
            videoPromise.then((videoTimings) => {
                $("body").css({ "background-color": "#0E0E10" });
                $('#loading').css({ "background-color": "#00000080" });
                $('#gridContainerCol').css({ visibility: 'hidden' }).addClass('push2right')

                const $blah2 = $(
                    `<div id="blah2" data-plyr-provider="youtube" data-plyr-embed-id="${videoId}">`
                );

                $("#playerWrapper").append($blah2);

                plyer = new Plyr("#blah2", {
                    mute: 0
                });

                const feedbackOnCurrentTime = (currentTime, source, forceScroll) => {
                    /*
                    const d = moment.duration(currentTime * 1000)
                    console.log(`Plyr ${source} event at ${currentTime} | ${fd(d)}`)
                    */
                    let i = 0
                    let barFound = 0
                    let done = false
                    const found = (bar) => {
                        const variation = bar2variation(bar)
                        $(".grid-brick").removeClass("playing")
                        $(`.grid-brick#gb${variation}`).addClass("playing");

                        const startBarOfVariation = variation2bar(variation)
                        let scroll = false
                        if (previousPlayOnBar != startBarOfVariation) {
                            previousPlayOnBar = startBarOfVariation
                            setCookie('previousPlayOnBar', previousPlayOnBar)
                            scroll = true
                        }
                        if (scrollIntoView) {
                            if (scroll || forceScroll) {
                                console.log(`[${source}], ${forceScroll ? "force" : "ask"} variation`, variation, 'to scroll into view')
                                $(`.grid-brick#gb${variation}`)[0].scrollIntoView({ behavior: "smooth", block: "nearest", inline: "nearest" })
                            }
                        }
                    }
                    for (let bar of videoTimings.bars) {
                        const d = bar.duration.asSeconds()
                        if (d > currentTime) {
                            found(barFound)
                            done = true
                            break
                        }
                        barFound = i
                        i++
                    }
                    if (!done) {
                        found(barFound)
                    }
                }

                const setBrickOnClickEvent = (videoTimings) => {
                    $(".brick.hasScore").off().on('click', function (e) {
                        const d = $(this).data()
                        // console.log('clicked on bar', d.bar)
                        if (typeof (d.bar) != "undefined") {
                            const isPlaying = plyer.playing
                            if (previousPlayOnBar == d.bar) {
                                // just toggle play state
                                if (isPlaying) {
                                    console.log('dear plyr, can you please pause?')
                                    plyer.pause();
                                } else {
                                    console.log('dear plyr, can you please play?')
                                    plyer.play()
                                }
                            } else {
                                let bar = videoTimings.bars[d.bar]
                                console.log('bar', d.bar, 'is @', bar["Time Recorded"])
                                console.log("seeking (on click)", d.bar, fd(bar.duration))
                                scrollIntoView = false
                                plyer.currentTime = bar.duration.asSeconds()
                                if (!isPlaying) {
                                    console.log('dear plyr, can you please restart playing?')
                                    plyer.play()
                                }
                                previousPlayOnBar = d.bar
                                setCookie('previousPlayOnBar', d.bar)
                            }
                        }
                    })
                }

                plyer.on('playing', (event) => {
                    console.log("Plyr playing event");
                    setCookie('playing', 'true')
                    scrollIntoView = true
                    feedbackOnCurrentTime(event.detail.plyr.currentTime, 'playing', true)
                });
                //
                plyer.on('pause', (event) => {
                    console.log("Plyr pause event");
                    $(".grid-brick").removeClass("playing")
                    setCookie('playing', 'false')
                });
                plyer.on('ended', (event) => {
                    console.log("Plyr ended event");
                    setCookie('playing', 'false')
                    setCookie('previousPlayOnBar', 0)
                });
                plyer.on('ready', (event) => {
                    console.log("Plyr ready event");
                    setBrickOnClickEvent(videoTimings)
                    setTimeout(() => {
                        $('.artist .name').html(artist == "Christophe Thiebaud" ? "Moi" : artist)
                        $('.artist .url').attr({
                            href: `https://youtu.be/${videoId}`,
                            target: videoId
                        })

                        $('#gridContainerCol').css({ visibility: 'visible' })
                        $('.score').css({ visibility: "visible" })
                        $('.video-container').css({ visibility: "visible" })
                        $("#grid").isotope({ filter: '*' })
                        hideLoading()

                        let previousPlayOnBar = getCookie('previousPlayOnBar');
                        if (!previousPlayOnBar || previousPlayOnBar == "undefined") previousPlayOnBar = 0
                        const bar = videoTimings.bars[previousPlayOnBar]
                        const isPlaying = getCookie('playing')
                        if (isPlaying === 'true') {
                            console.log("Dear plyr, last time we met, you where playing, weren't you? May I politely ask you to resume playing?")
                            setTimeout(() => {
                                // youtube annoying "feature" (no sound before play/pause)
                                // https://github.com/sampotts/plyr/issues/1527#issuecomment-519398492
                                plyer.play()
                                plyer.pause()
                                plyer.play()
                            }, 1000)
                        }
                        console.log("Dear plyr, as you are ready, can you seek at bar <", previousPlayOnBar, "> (", bar["Time Recorded"], ") ?")
                        plyer.currentTime = bar.duration.asSeconds()

                        finalizePlayerInitilization()

                    }, 1000)

                });

                const finalizePlayerInitilization = () => {
                    plyer.on('timeupdate', (event) => {
                        scrollIntoView = true
                        feedbackOnCurrentTime(event.detail.plyr.currentTime, 'timeupdate')
                    });
                    /*
                    plyer.on('playing', (event) => {
                        console.log("Plyr playing event");
                        setCookie('playing', 'true')
                        scrollIntoView = true
                        // feedbackOnCurrentTime(event.detail.plyr.currentTime, 'playing', true)
                    });
                    */
                    plyer.on('seeking', (event) => {
                        const seekTime = event.detail.plyr.media.duration * (event.detail.plyr.elements.inputs.seek.value / 100);
                        feedbackOnCurrentTime(seekTime, 'seeking')
                    });
                    plyer.on('seeked', (event) => {
                        feedbackOnCurrentTime(event.detail.plyr.currentTime, 'seeked')
                    });
                }
            })
        }
    </script>
    <script type='module'>
        import tinycolor from "https://esm.sh/tinycolor2";

        // http://stackoverflow.com/questions/20789373/shuffle-array-in-ng-repeat-angular
        // -> Fisher–Yates shuffle algorithm
        function shuffleArray(array) {
            let m = array.length,
                t, i;
            // While there remain elements to shuffle
            while (m) {
                // Pick a remaining element…
                i = Math.floor(Math.random() * m--);
                // And swap it with the current element.
                t = array[m];
                array[m] = array[i];
                array[i] = t;
            }
            return array;
        }

        const _widths_ = [
            { w: 270 },
            { w: 278 },
            { w: 288 },
            { w: 277 },
            { w: 285 },
            { w: 311 },
            { w: 306 },
            { w: 284 },
            { w: 328 },
            { w: 316 },
            { w: 378 },
            { w: 280 },
            { w: 250 },
            { w: 253 },
            { w: 247 },
            { w: 353 },
            { w: 319 },
            { w: 288 },
            { w: 285 },
            { w: 314 },
            { w: 310 },
            { w: 305 },
            { w: 310 },
            { w: 248 },
            { w: 257 },
            { w: 264 },
            { w: 260 },
            { w: 282 },
            { w: 314 },
            { w: 330 },
            { w: 325 },
            { w: 343 },
            { w: 252 },
            { w: 188 },
            { w: 170 }
        ]

        let _first_color_ = [
            { rgb: "f3f3f2", p_rgb: "f2f1f0", sim: 97, pantone: "P 179-1 C", name: "Bleached Silk" }
        ]

        let _other_colors_ = [
            { rgb: "6a8d88", p_rgb: "6c8a82", sim: 98, pantone: "625 U", name: "Aspen Hush" },
            { rgb: "112222", p_rgb: "1b2f34", sim: 95, pantone: "5463 CP", name: "Black Feather" },
            { rgb: "222244", p_rgb: "252849", sim: 98, pantone: "282 CP", name: "Black Market" },
            { rgb: "2242c7", p_rgb: "24509a", sim: 91, pantone: "286 CP", name: "Blue Blue" },
            { rgb: "2a96d5", p_rgb: "1f95cd", sim: 98, pantone: "7508 UP", name: "Boyzone" },
            { rgb: "a3c1ad", p_rgb: "a6c2ad", sim: 99, pantone: "P 134-11 U", name: "Cambridge Blue" },
            { rgb: "f5a2a1", p_rgb: "f6a1a0", sim: 100, pantone: "15-1621 TPX", name: "Candy Heart Pink" },
            { rgb: "697f8e", p_rgb: "6a7f8e", sim: 100, pantone: "692 UP", name: "Cascade Tour" },
            { rgb: "3c1414", p_rgb: "4e2b1f", sim: 92, pantone: "7596 CP", name: "Dark Sienna" },
            { rgb: "355859", p_rgb: "335959", sim: 99, pantone: "19-5413 TCX", name: "Depth Charge" },
            { rgb: "3a445d", p_rgb: "3b4559", sim: 98, pantone: "2379 C", name: "Diplomatic" },
            { rgb: "ffd8bb", p_rgb: "ffd4b2", sim: 98, pantone: "13-1026 TPX", name: "Durazno Palido" },
            { rgb: "0abab5", p_rgb: "00baae", sim: 97, pantone: "3262 U", name: "Jade Gravel" },
            { rgb: "f7a233", p_rgb: "f9a12e", sim: 99, pantone: "15-1058 TPG", name: "Lightning Yellow" },
            { rgb: "b66a3c", p_rgb: "ba6a3b", sim: 99, pantone: "P 31-7 C", name: "Mincemeat" },
            { rgb: "6fea3e", p_rgb: "87e878", sim: 94, pantone: "902 U", name: "Miyazaki Verdant" },
            { rgb: "ec8430", p_rgb: "f38b3c", sim: 98, pantone: "144 U", name: "Navel" },
            { rgb: "a328b3", p_rgb: "9b26b6", sim: 98, pantone: "2592 C", name: "Pink Spyro" },
            { rgb: "fcffff", p_rgb: "c7dbf4", sim: 87, pantone: "2707 U", name: "Polar Bear In A Blizzard" },
            { rgb: "881166", p_rgb: "890c58", sim: 96, pantone: "228 C", name: "Possessed Purple" },
            { rgb: "11875d", p_rgb: "13955e", sim: 95, pantone: "P 145-8 U", name: "Primal Green" },
            { rgb: "8a3319", p_rgb: "8a391b", sim: 98, pantone: "7526 C", name: "Red Rust" },
            { rgb: "0c1793", p_rgb: "10069f", sim: 97, pantone: "Blue 072 C", name: "Royal" },
            { rgb: "e84998", p_rgb: "e44c9a", sim: 99, pantone: "Rhodamine Red U", name: "Schiaparelli Pink" },
            { rgb: "ffe670", p_rgb: "ffe671", sim: 100, pantone: "924 C", name: "Shandy" },
            { rgb: "7777ff", p_rgb: "6490e8", sim: 90, pantone: "2727 U", name: "Stargate Shimmer" },
            { rgb: "0c0c1f", p_rgb: "131e29", sim: 91, pantone: "7547 C", name: "Tristesse" },
            { rgb: "b12d35", p_rgb: "b42937", sim: 99, pantone: "P 58-8 C", name: "Unmatched Beauty" },
            { rgb: "e34244", p_rgb: "e73c3e", sim: 99, pantone: "2034 C", name: "Vermilion Cinnabar" },
            { rgb: "e3ac72", p_rgb: "e2a770", sim: 98, pantone: "721 CP", name: "Viva Gold" },
            { rgb: "4b57db", p_rgb: "275ea3", sim: 89, pantone: "10261 C", name: "Warm Blue" },
            { rgb: "bfd6d9", p_rgb: "bcd5d6", sim: 99, pantone: "5523 U", name: "Wind Speed" },
        ];

        let _last_color_ = [
            { rgb: "000000", p_rgb: "232222", sim: 92, pantone: "Neutral Black C", name: "Bleached Silk" }
        ]

        let _colors_ = _first_color_.concat(_other_colors_)

        for (let s of _colors_) {
            s.luminance = tinycolor(s.p_rgb).getLuminance();
        }
        _colors_ = _colors_.sort((a, b) => b.luminance - a.luminance)
        const max = _colors_[0].luminance
        const min = _colors_[_colors_.length - 1].luminance
        const normalize = (val, max, min) => (val - min) / (max - min)
        _colors_ = _first_color_.concat(shuffleArray(_other_colors_))
        let k = 0
        const transparency = .667
        _colors_.push(_last_color_[0])
        for (let s of _colors_) {
            // https://cubic-bezier.com/
            let easing = BezierEasing(.5, .5, .5, .5)
            easing = BezierEasing(0, 1, 1, .4)
            // const nl = normalize(s.luminance, max, min)
            s.nl = normalize(k++, (_colors_.length - 1) + 1, 0)
            s.brightnessChange = (1 - easing(s.nl)) * 100 // s.luminance *100 // 
            if (tinycolor(s.p_rgb).isLight()) {
                s.textColor = tinycolor(s.p_rgb).darken(s.brightnessChange).toString("hex6").slice(1)
                s.stripeColor = tinycolor(s.p_rgb).darken(10).toString("hex6").slice(1)
            } else {
                s.textColor = tinycolor(s.p_rgb).lighten(s.brightnessChange).toString("hex6").slice(1)
                s.stripeColor = tinycolor(s.p_rgb).lighten(10).toString("hex6").slice(1)
            }
            s.borderColor = tinycolor(s.p_rgb).lighten(30).toString("hex6").slice(1)
            // some transparency to show video behind
            if (videoId) {
                s.p_rgb = tinycolor(s.p_rgb).setAlpha(transparency).toString("hex8").slice(1)
                s.textColor = tinycolor(s.textColor).setAlpha(transparency).toString("hex8").slice(1)
                s.stripeColor = tinycolor(s.stripeColor).setAlpha(transparency).toString("hex8").slice(1)
                s.borderColor = tinycolor(s.borderColor).setAlpha(transparency).toString("hex8").slice(1)
            }
        }

        let $gridById = $("#grid")

        $gridById.isotope({
            layoutMode: 'packery',
            itemSelector: ".grid-brick",
            filter: ':not(.artist)',
            packery: {
                gutter: 0,
            }
        });

        const $bricksTemporaryContainer = $("<span>");
        const templateForTheme =
            `
<div class="grid-brick">
    <div class="d-flex brick align-items-center justify-content-center mb-3" style="border-radius: 0; background-image: url('/manuscriptFirstLine.jpg'); background-repeat: no-repeat; background-size: cover; background-position-y: center; height: 100%;">
        <div class="magnificient-card p-2" style="backdrop-filter: blur(1px);">
            ${'&nbsp;Ciaccona&nbsp;'}
        </div>
    </div>
</div>`
        $bricksTemporaryContainer.append($(templateForTheme));

        const templateForArtist =
            `
<div class="grid-brick artist">
    <div class="d-flex brick align-items-center justify-content-center mb-3" style="border-radius: 0; height: 100%;">
        <div class="p-2" >
            <a class="url text-muted p-2" href="#" style="background-color: #505050c0; border-radius: .5rem;">
                <span class="name" style="color: #d0d0d0">?</span>
                &nbsp;
                <svg width="20" height="20" preserveAspectRatio="xMidYMid meet">
                    <use xlink:href="#external-link"></use>
                </svg>
            </a>
        </div>
    </div>
</div>`
        $bricksTemporaryContainer.append($(templateForArtist));

        let i = 0;
        let barFrom = 0
        _colors_.forEach(function (c) {
            const tonality = (17 <= i && i < 27) ? "Δ" : "";
            const duration = index2duration(i)
            const warning = duration != 8 ? `(${duration})` : "";
            const barTo = barFrom + duration
            const bg = true ? // !tonality ?
                `background-color: #${c.p_rgb};`
                :
                `background-image: linear-gradient(135deg, 
                #${c.stripeColor} 10%, 
                #${c.p_rgb} 10%, 
                #${c.p_rgb} 50%, 
                #${c.stripeColor} 50%, 
                #${c.stripeColor} 60%, 
                #${c.p_rgb} 60%, 
                #${c.p_rgb} 100%); 
                background-size: 16.97px 16.97px;`

            const svgOffsetX = (i == 0 || i == 17 || i == 27 || i == 33 ? "0" : "6.5")

            const templateVariations =
                `
<div id="gb${i}" class="${tonality ? tonality + ' ' : ''}grid-brick" style="border-color: #${c.borderColor}">
    <div class="brick hasScore font-monospace d-flex align-items-center justify-content-between" style="${bg};" data-bar="${barFrom}">
        <div class="score" style="width: ${(_widths_[i].w) - 120}px; visibility: hidden; " data-width="${(_widths_[i].w) - 120}">

            <object id="o${i}" 
                    data="scores/bwv-1004_5_for_PNGs-${i + 1}.svg" 
                    type="image/svg+xml"
                    style="pointer-events: none;" 
                    data-svg-offset-x = ${svgOffsetX}> 
            </object>

            <span class="Δ" style="${bg}">
                ${tonality}
            </span>
        </div>
        <div class="flex-grow-1"></div>
        <div style="${i == _colors_.length - 1 ? "display:none;" : ""}font-style: italic; font-size:.8rem; color: #${c.textColor};">
            ${warning}
        </div>
        <div style="${i == _colors_.length - 1 ? "display:none;" : ""}font-size:1.1rem; padding: 0 .3rem; border-right: .5px solid #${c.textColor}; color: #${c.textColor}">
            ${barFrom + 1}<br\>${barTo}
        </div>
        <div class="fw-bold text-center" style="${i == _colors_.length - 1 ? "display:none;" : ""}margin-top: auto; margin-bottom: .5rem; min-width: 3rem; color: #${c.textColor};">
            ${i == 0 ? "" : i}
        </div>
    </div>
</div>
`
            $bricksTemporaryContainer.append($(templateVariations));

            // bumpers
            barFrom = barFrom += duration
            i++
        });

        const oblivion =
            `
<div class="grid-brick">
    <div class="brick d-flex align-items-center justify-content-center" style="border-radius: 0; background-color: black">
        <div class="glowing_bubble_siegel">
            <div class="magnificient-card p-2" style="backdrop-filter: blur(.2px);">
                ${'&nbsp;BWV&nbsp;1004&nbsp;'}
            </div>
        </div>    
    </div>
</div>
`
        $bricksTemporaryContainer.append($(oblivion))

        const $bricks = $bricksTemporaryContainer.children()

        $gridById.empty().append($bricks).isotope('appended', $bricks)

        if (fullWidthChecked) {
            $('#gridContainerCol').addClass('fullwidth')
            $('.grid-brick, .score').addClass('fullwidth')
            $("#grid").isotope('layout')
        }

        $(".brick").click(function (e) {
            console.log("clicked on brick")
            e.stopPropagation();
            $('.dropdown-toggle#dropdownMenuLink').dropdown('toggle');
        });

    </script>
</body>

</html>