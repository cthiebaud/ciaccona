<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <!-- meta name="viewport" content="width=device-width, initial-scale=1" -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <meta name="keywords" content="Bach, JSBach, BWV1004, Partita, Ciaconna, Chaconne">
    <meta name="author" content="Christophe Thiebaud">

    <!-- HTML Meta Tags -->
    <title>Ciaccona</title>
    <meta name="description" content='The "Tribune des Critiques de Disques" of the Ciaccona (/Chaconne) of the 2nd Partita BWV 1004 by JS Bach'>

    <!-- https://realfavicongenerator.net/ -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Facebook Meta Tags -->
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="ciaccona.cthiebaud.com" />
    <meta property="og:url" content="https://ciaccona.cthiebaud.com/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Ciaccona">
    <meta property="og:description" content="La Tribune des Critiques de Disques de la Ciaccona ou Chaconne de la 2ème Partita BWV 1004 de JS Bach">
    <meta property="og:image" content="https://ciaccona.cthiebaud.com/logo2.jpg" />
    <meta property="og:image:url" content="https://ciaccona.cthiebaud.com/logo2.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="2400" />
    <meta property="og:image:height" content="1260" />

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@cthiebaud">
    <meta property="twitter:domain" content="ciaccona.cthiebaud.com">
    <meta property="twitter:url" content="https://ciaccona.cthiebaud.com/">
    <meta name="twitter:title" content="Ciaccona">
    <meta name="twitter:description" content="La Tribune des Critiques de Disques de la Ciaccona ou Chaconne de la 2ème Partita BWV 1004 de JS Bach">
    <meta name="twitter:image" content="https://ciaccona.cthiebaud.com/logo2.jpg">

    <!-- video player -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@latest/dist/plyr.css">
    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <!-- early scripts -->
    <script src="https://cdn.jsdelivr.net/npm/lodash@latest/lodash.min.js"></script>
    <script>
        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });
        // Get the value of "some_key" in eg "https://example.com/?some_key=some_value"
        let ytID = params.yt; // "some_value"
        const logo = params.logo; // "some_value"
        if (logo === "true") {
            ytID = undefined
        }
    </script>

    <script src="/resizeSVGs.js"></script>

    <script>
        // <!-- CSS variable for dimensions -->
        const afterResizeWindow = () => {
            // https://css-tricks.com/the-trick-to-viewport-units-on-mobile/
            const vh = window.innerHeight * 0.01
            const vw = window.innerWidth * 0.01

            // Then we set the value in the --vh custom property to the root of the document
            document.documentElement.style.setProperty('--vh', `${vh}px`)
            document.documentElement.style.setProperty('--vw', `${vw}px`)
        }
        afterResizeWindow()
        window.addEventListener('resize',
            _.debounce(() => {
                afterResizeWindow()
            }, 750)
        );

        // <!-- resize each SVG to its bounding box -->
        window.addEventListener('load', (event) => {
            resizeSVGs(
                document.querySelectorAll('object'),
                (o) => {
                    $(o).parent().css({ visibility: "visible" })
                }, () => {
                    console.log("all SVGs resized!")
                })
        });
    </script>

    <!-- google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&display=swap" rel="stylesheet">

    <!-- -->
    <style>
        body {
            /* https://css-tricks.com/the-trick-to-viewport-units-on-mobile/ */
            /* fallback for browsers that do not support custom properties */
            height: 100vh;
            /* custom properties */
            height: calc(var(--vh, 1vh) * 100);
        }

        .container-fluid {
            height: calc(var(--vh, 1vh) * 100);
        }

        a {
            text-decoration: none;
        }

        #gridContainer {
            padding: .5rem 0;
        }

        #gridContainerCol {
            margin: 0;
            padding: 0;
        }

        #gridContainerCol.push2right {
            max-width: min(var(--vw, 1vw) * 100, 23.5rem);
            height: calc(var(--vh, 1vh) * 100 - 57px) !important;
            overflow-y: scroll;
            margin: 0;
            padding: 0;
        }

        .grid-brick {
            font-size: 1.4rem;
            width: min(var(--vw, 1vw) * 100, 23.5rem);
            height: 6rem;
            padding: .5rem;
            border-style: dashed;
            border-width: 4px !important;
            cursor: pointer;
        }

        .grid-brick.playing {
            border-radius: 0 !important;
        }

        .grid-brick:not(.playing) {
            border-radius: 0 !important;
            border-color: transparent !important;
        }

        .grid-brick.playing .brick {
            border-radius: 0 !important;
        }

        .grid-brick.playing .score {
            border-radius: 0 !important;
            width: 100% !important;
        }

        .grid.playing object {
            border-radius: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }

        .grid-brick.playing .brick :not(:first-child) {
            display: none !important;
        }

        .grid-brick.Δ2 {
            background-color: rgba(128, 128, 128, .3);
        }

        .brick {
            border-radius: 0 3rem 3rem 0;
            width: 100%;
            height: 100%;
        }

        .score {
            position: relative;
            height: 5rem;
            cursor: pointer;
            overflow: hidden;
            border-radius: 0 3rem 3rem 0;
        }

        .score object {
            background-color: rgba(255, 255, 255, .8);
            height: 100%;
            background-clip: padding-box;
            position: absolute;
            display: block;
        }

        body.siegel {
            background-image: url('svg/Bachsiegel_glowing_bubble.svg'), url('svg/BachsiegelColorWheel.svg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center center;
            background-blend-mode: color-burn;
        }

        .siegel {
            background-image: url('svg/Bachsiegel_glowing_bubble.svg');
            background-size: contain;
            background-repeat: no-repeat;
            background-color: #ddd;
            background-position-x: center;
            background-size: 60%;
            background-position-y: 50%;
            border-radius: 1rem;
        }

        .magnificient-card {
            font-family: 'Cinzel', serif;
            font-size: 24px;
            outline: 1px solid gray;
            outline-offset: -2px;
            background-clip: content-box;
            text-align: center;
            background-color: rgba(255, 255, 255, .5);
            border-radius: 1rem;
            color: #121212;
        }

        .Δ {
            font-family: 'Cinzel', serif;
            font-size: smaller;
            float: left;
            padding-right: .3rem;
            position: relative;
            background-color: rgba(0, 0, 0, .25);
            border-bottom-right-radius: 1rem;
            color: rgba(255, 255, 255, .75);
        }

        .video-container {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            padding: 0;
            opacity: 1;
        }

        .plyr:not(.plyr--playing) .plyr__video-embed {
            filter: blur(.8rem);
        }

        /* https://stackoverflow.com/a/60192837/1070215 */
        .plyr .plyr__video-embed {
            position: relative;
            overflow: hidden;
            width: calc(var(--vw, 1vw) * 100);
            height: calc(var(--vh, 1vh) * 100);
            pointer-events: none;
        }

        .plyr .plyr__video-embed iframe {
            position: absolute;
            top: 50%;
            left: 50%;
            width: calc(var(--vw, 1vw) * 100);
            height: calc(var(--vh, 1vh) * 100);
            transform: translate(-50%, -50%);
        }

        @media (min-aspect-ratio: 16/9) {
            .plyr .plyr__video-embed iframe {
                /* height = 100 * (9 / 16) = 56.25 */
                height: 56.25vw;
            }
        }

        @media (max-aspect-ratio: 16/9) {
            .plyr .plyr__video-embed iframe {
                /* width = 100 / (9 / 16) = 177.777777 */
                width: calc(var(--vh, 1vh) * 177.78);
            }
        }

        iframe {
            display: block;
            margin: 0 auto;
        }

        li a.dropdown-item {
            max-height: 32px;
        }

        li a.dropdown-item img {
            height: 40px;
            overflow-y: visible;
        }

        li a.dropdown-item div {
            margin-left: 1rem;
        }

        .d-flex[style*="display:none"],
        .d-flex[style*="display: none"] {
            display: none !important;
        }
    </style>
</head>

<body class="d-flex flex-column">

    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="facebook" viewBox="0 0 16 16">
            <path
                d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
        </symbol>
        <symbol id="instagram" viewBox="0 0 16 16">
            <path
                d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z" />
        </symbol>
        <symbol id="twitter" viewBox="0 0 16 16">
            <path
                d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" />
        </symbol>

        <symbol id="youtube" viewBox="48.86 79.22 202.27 141.55">
            <g transform="scale(.75)">
                <path fill="red"
                    d="M199.91667116 105.6302382s-84.29180001.00007866-105.44791902 5.49739608c-11.32771618 3.16506938-20.655211 12.49266687-23.82031238 23.98698305-5.49727075 21.15613367-5.49739608 64.9687477-5.49739608 64.9687477s.00012533 43.97893404 5.49739608 64.80208104c3.16510139 11.49416018 12.3260082 20.65517366 23.82031238 23.82032038 21.32270701 5.6638401 105.44791902 5.66405342 105.44791902 5.66405342s84.45890802-.00006666 105.61458836-5.49738675c11.49438685-3.16508005 20.655107-12.15954686 23.65364037-23.82032038 5.66390676-20.98976034 5.66406676-64.80208104 5.66406676-64.80208104s.16645334-43.9792807-5.66406676-65.13541437c-2.99853338-11.49431618-12.15925352-20.65511233-23.65364037-23.65364971-21.15568034-5.83046276-105.61458836-5.83072943-105.61458836-5.83072943zm-26.8203071 53.97395285 70.13281446 40.47917398-70.13281445 40.31250732v-80.7916813z" />
            </g>
        </symbol>
    </svg>

    <div class="dropdown" style="float: left; background: transparent; z-index: 1001; border: none; margin: .5rem;">
        <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false"
            style="background: #00000040; border: none;">
            <svg width="32" height="32">
                <use xlink:href="#youtube"></use>
            </svg>
        </a>

        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=mg9kT7XiLoU'"><img src="svg/violin.svg">
                    <div>Amandine Beyer</div>
                </a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=Ilb3no_cwnI'">&nbsp; <div>Veronika Eberle</div></a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=r67BASAgP5Q'">&nbsp; <div>Isabelle Faust</div></a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=KgSKvOAJMb8'">&nbsp; <div>Midori Gotō</div></a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=XkfsGCIiHb4'">&nbsp; <div>Bella Hristova </div></a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=dyAcRqpjbqU'">&nbsp; <div>Lisa Jacobs</div></a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=NCTDf8dNT5s'">&nbsp; <div>Sigiswald Kuijken</div></a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=i3UhcV76BlE'">&nbsp; <div>Rachel Podger</div></a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=59KFAY_qf-Q'">&nbsp; <div>Rachell Ellen Wong</div></a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=lxZqC_J0C74'"><img src="svg/guitar.svg"
                        style="top: -0.5rem; position: relative;">
                    <div>Petra Poláčková</div>
                </a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=Jcy7E4uHYK8'">&nbsp; <div>Raphaella Smits</div></a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=oxWq93mlAyc'">&nbsp; <div>Andrea De Vitis</div></a></li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=Vslz1tDsaWw'">&nbsp; <div>Moi</div></a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=SzxzLtwK-eo'"><img src="svg/piano.svg"
                        style="top: -0.5rem; position: relative;">
                    <div>Chiara Massini</div>
                </a>
            </li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=KHwsHXtVWks'"><img src="svg/harp.svg"
                        style="top: -0.5rem; position: relative;">
                    <div>Anneleen Lenaerts</div>
                </a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/?yt=BYg7Di8CH9w'"><img src="svg/marimba.svg"
                        style="top: -0.66rem; position: relative;">
                    <div>Mika Stoltzman</div>
                </a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item d-flex justify-content-between" href="#" onclick="location = '/'">
                    &nbsp;<div style="font-size:20pt; top: -0.5rem; position: relative;">🏠<!--∅--></div>
                </a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item d-flex justify-content-center" href="#" onclick="location = '/?logo=true'">
                    &nbsp;<img style="top: -0.5rem; position: relative;" src="svg/BachsiegelColorWheel.svg">
                </a></li>
        </ul>
    </div>

    <main id="gridContainer" class="container-fluid my-center flex-shrink-0"
        style="z-index: 999;position: absolute; top:0; left:0; padding-top: .5rem; padding-bottom: .5rem; height: 100%;">
        <div id="gridContainerRow" class="row justify-content-end" style="margin:0"> <!--  -->
            <div id="playerWrapper" class="col video-container" data-plyr-provider="youtube" data-plyr-embed-id="" style="visibility: hidden">
            </div>
            <div id="gridContainerCol" class="col" style="visibility: hidden"> <!--  -->
                <div id="grid">
                </div>
            </div>
        </div>
    </main>

    <footer style="display: none !important; z-index: 1000;" class="footer mt-auto p-3 bg-light d-flex flex-wrap justify-content-between align-items-center border-top">
        <div class="col-md-4 d-flex align-items-center">
            <span class="text-muted">© 2023 Christophe Thiebaud</span>
        </div>
        <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
            <li class="ms-3">
                <a target="twitter" href="https://twitter.com/cthiebaud">
                    <svg width="24" height="24">
                        <use xlink:href="#twitter"></use>
                    </svg>
                </a>
            </li>
            <!-- li class="ms-3">
                <a class="text-muted" target="instagram" href="https://www.instagram.com/cthiebaud/">
                    <svg width="24" height="24">
                        <use xlink:href="#instagram"></use>
                    </svg>
                </a>
            </li -->
            <li class="ms-3">
                <a class="text-muted" target="facebook" href="https://www.facebook.com/christophe.thiebaud">
                    <svg width="24" height="24">
                        <use xlink:href="#facebook"></use>
                    </svg>
                </a>
            </li>
            <li class="ms-3">
                <a class="text-muted" target="youtube" href="https://www.youtube.com/channel/UCxt1pFJkKS3LlhmSsHCrZkg">
                    <svg width="32" height="32">
                        <use xlink:href="#youtube"></use>
                    </svg>
                </a>
            </li>
        </ul>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/isotope-layout@latest/dist/isotope.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/isotope-packery@latest/packery-mode.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bezier-easing@2.1.0/dist/bezier-easing.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@latest/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plyr@latest/dist/plyr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/imagesloaded@latest/imagesloaded.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>

    <script src="timings/AmandineBeyer-mg9kT7XiLoU.js"></script>
    <script src="timings/BellaHristova-XkfsGCIiHb4.js"></script>
    <script src="timings/IsabelleFaust-r67BASAgP5Q.js"></script>
    <script src="timings/MidoriGotō-KgSKvOAJMb8.js"></script>
    <script src="timings/MikaStoltzman-BYg7Di8CH9w.js"></script>
    <script src="timings/RaphaellaSmits-Jcy7E4uHYK8.js"></script>
    <script src="timings/VeronikaEberle-Ilb3no_cwnI.js"></script>
    <script src="timings/LisaJacobs-dyAcRqpjbqU.js"></script>
    <script src="timings/AnneleenLenaerts-KHwsHXtVWks.js"></script>
    <script src="timings/RachelPodger-i3UhcV76BlE.js"></script>
    <script src="timings/ChiaraMassini-SzxzLtwK-eo.js"></script>
    <script src="timings/AndreaDeVitis-oxWq93mlAyc.js"></script>
    <script src="timings/PetraPoláčková-lxZqC_J0C74.js"></script>
    <script src="timings/SigiswaldKuijken-NCTDf8dNT5s.js"></script>
    <script src="timings/RachellEllenWong-59KFAY_qf-Q.js"></script>

    <script src="timings/ChristopheThiebaud-Vslz1tDsaWw.js"></script>

    <script>
        if (logo === "true") {
            $('body').addClass('siegel');
            $('#gridContainerCol').css({ display: 'none' })
            $('footer.footer').show()
        } else {
            $('footer.footer').hide()
        }
        let  all = undefined
        if (ytID) {
            let one = ytID.replace('-', '_')
            let two = one.replace(/^(\d.*)/i, '_$1')
            all = eval(two)
        }
        console.log(ytID, all)
        if (all) {
            const createBarDuration = (bar) => {
                if (!bar.m) {
                    bar.m = new moment(bar["Time Recorded"])
                }
                bar.duration = moment.duration(bar.m.diff(all.start))
                if (all.offset) {
                    bar.duration.add(all.offset)
                }
                if (all.adjust) {
                    bar.duration.subtract(all.adjust)
                }
                return bar
            }
            all.ciacconaStart = createBarDuration({ m: all.start })
            for (let bar of all.bars) {
                createBarDuration(bar)
            }
        }
        let previousPlayOnBar = Cookies.get('previousPlayOnBar');
        if (!previousPlayOnBar) previousPlayOnBar = 0


        const variationsBars = [
        ]
        const index2duration = (i) => (i == 10 || i == 15 || i == 19 || i == 29) ? 4 : ((i == 8 || i == 30) ? 12 : 8)
        {
            let bar = 0
            for (let i = 0; i < 34; i++) {
                const duration = index2duration(i)
                variationsBars.push(bar)
                bar = bar + duration
            }
        }
        const variation2bar = (variation) => {
            return variationsBars[variation]
        }
        const bar2variation = (bar) => {
            let previousVar = 0
            for (let variation = 0; variation < variationsBars.length; variation++) {
                if (bar < variationsBars[variation]) {
                    return previousVar
                }
                previousVar = variation;
            }
            return previousVar
        }

        if (!ytID) {
            $('#gridContainerCol').css({ visibility: 'visible' })
        } else {
            $("body").css({ "background-color": "black" });
            $('#gridContainerCol').css({ visibility: 'hidden' })

            const $blah2 = $(
                `<div id="blah2" data-plyr-provider="youtube" data-plyr-embed-id="${ytID}">`
            );

            $("#playerWrapper").append($blah2);

            plyer = new Plyr("#blah2", {
                mute: 0
            });

            const feedbackOnCurrentTime = (currentTime) => {
                let i = 0
                let barFound = 0
                let done = false
                const found = (bar) => {
                    const variation = bar2variation(bar)
                    $(".grid-brick").removeClass("playing")
                    $(`.grid-brick#gb${variation}`).addClass("playing");

                    const startBarOfVariation = variation2bar(variation)
                    if (previousPlayOnBar != startBarOfVariation) {
                        previousPlayOnBar = startBarOfVariation
                        Cookies.set('previousPlayOnBar', previousPlayOnBar)
                        console.log('seeked or playing variation', variation, '(should scroll into view)')
                        $(`.grid-brick#gb${variation}`)[0].scrollIntoView({ behavior: "smooth", block: "nearest", inline: "nearest" })
                        // setTimeout(() => { }, 1000)
                    }
                }
                for (let bar of all.bars) {
                    const d = bar.duration.asSeconds()
                    if (d > currentTime) {
                        found(barFound)
                        done = true
                        break
                    }
                    barFound = i
                    i++
                }
                if (!done) {
                    found(barFound)
                }

                // console.log("Plyr timeupdate", event.detail.plyr.currentTime);
            }

            //
            plyer.on('ready', (event) => {
                console.log("Plyr ready event");
                $('#gridContainerCol').addClass('push2right').css({ visibility: 'visible' })
                $("#grid").isotope('layout')
                plyer.muted = false
                plyer.pause();
                setTimeout(() => {
                    let bar = all.bars[previousPlayOnBar]
                    console.log("seeking (on Plyr ready)", bar["Time Recorded"])
                    if (Cookies.get('playing') == 'true') {
                        plyer.play();
                    }
                    plyer.currentTime = bar.duration.asSeconds()
                    $('.video-container').css({ visibility: "visible" })
                }, 666)

            });
            plyer.on('timeupdate', (event) => {
                const currentTime = event.detail.plyr.currentTime

                if (plyer.playing) {
                    // scroll score
                }
                feedbackOnCurrentTime(currentTime)
            });
            plyer.on('playing', (event) => {
                Cookies.set('playing', 'true', { expires: 7 })
                console.log("Plyr playing event");
                /*
                if (plyer.playing) {
                    // heuristic to calc score scroll offset
                    // 1. get object width
                    const oWidth = $('.grid-brick.playing .score object').width() 
                    // 2. get parent .score width
                    const sWidth = $('.grid-brick.playing .score').width() 
                    // 3. get start time of current variation
                    let start = all.bars[previousPlayOnBar].m
                    const start2 = moment.duration(start.diff(all.start))
                    // 4. get variation duration
                    let end = all.bars[parseInt(previousPlayOnBar, 10)+1].m
                    const dur = moment.duration(end.diff(start))
                    const dur2 = dur.asMilliseconds()
                    console.log('duration', Math.round(dur2), 'score width', Math.round(oWidth-sWidth))

                    // une petite règle de trois
                    // offset = ( (currentTime - start) * (oWidth - sWidth) ) duration
                    const offset = 100*( (currentTime *1000 - start2) * (oWidth - sWidth) ) / (dur2 * 1000)

                    // 
                    console.log(Math.round(currentTime), Math.round(offset) )
                    // scroll
                    toggleAnimate(true, document.querySelector('.grid-brick.playing object'), { action: "start" })
                }
                */
            });
            plyer.on('seeking', (event) => {
                const currentTime = event.detail.plyr.currentTime
                console.log('Plyr seeking event at', currentTime)
                feedbackOnCurrentTime(currentTime)
            });
            plyer.on('pause', (event) => {
                /*
                toggleAnimate(document.querySelector('.grid-brick.playing object'), { action: "stop" })
                */
                $(".grid-brick").removeClass("playing")
                Cookies.set('playing', 'false', { expires: 7 })
                console.log("Plyr pause event");
            });
            plyer.on('ended', (event) => {
                console.log("Plyr ended event");
            });
        }
    </script>
    <script type='module'>
        import tinycolor from "https://esm.sh/tinycolor2";

        // http://stackoverflow.com/questions/20789373/shuffle-array-in-ng-repeat-angular
        // -> Fisher–Yates shuffle algorithm
        function shuffleArray(array) {
            let m = array.length,
                t, i;
            // While there remain elements to shuffle
            while (m) {
                // Pick a remaining element…
                i = Math.floor(Math.random() * m--);
                // And swap it with the current element.
                t = array[m];
                array[m] = array[i];
                array[i] = t;
            }
            return array;
        }

        const _widths_ = [
            { w: 270 },
            { w: 278 },
            { w: 288 },
            { w: 277 },
            { w: 285 },
            { w: 311 },
            { w: 306 },
            { w: 284 },
            { w: 328 },
            { w: 316 },
            { w: 378 },
            { w: 280 },
            { w: 250 },
            { w: 253 },
            { w: 247 },
            { w: 353 },
            { w: 319 },
            { w: 288 },
            { w: 285 },
            { w: 314 },
            { w: 310 },
            { w: 305 },
            { w: 310 },
            { w: 248 },
            { w: 257 },
            { w: 264 },
            { w: 260 },
            { w: 282 },
            { w: 314 },
            { w: 330 },
            { w: 325 },
            { w: 343 },
            { w: 252 },
            { w: 188 },
            { w: 170 }
        ]

        let _first_color_ = [
            { rgb: "f3f3f2", p_rgb: "f2f1f0", sim: 97, pantone: "P 179-1 C", name: "Bleached Silk" }
        ]

        let _other_colors_ = [
            { rgb: "6a8d88", p_rgb: "6c8a82", sim: 98, pantone: "625 U", name: "Aspen Hush" },
            { rgb: "112222", p_rgb: "1b2f34", sim: 95, pantone: "5463 CP", name: "Black Feather" },
            { rgb: "222244", p_rgb: "252849", sim: 98, pantone: "282 CP", name: "Black Market" },
            { rgb: "2242c7", p_rgb: "24509a", sim: 91, pantone: "286 CP", name: "Blue Blue" },
            { rgb: "2a96d5", p_rgb: "1f95cd", sim: 98, pantone: "7508 UP", name: "Boyzone" },
            { rgb: "a3c1ad", p_rgb: "a6c2ad", sim: 99, pantone: "P 134-11 U", name: "Cambridge Blue" },
            { rgb: "f5a2a1", p_rgb: "f6a1a0", sim: 100, pantone: "15-1621 TPX", name: "Candy Heart Pink" },
            { rgb: "697f8e", p_rgb: "6a7f8e", sim: 100, pantone: "692 UP", name: "Cascade Tour" },
            { rgb: "3c1414", p_rgb: "4e2b1f", sim: 92, pantone: "7596 CP", name: "Dark Sienna" },
            { rgb: "355859", p_rgb: "335959", sim: 99, pantone: "19-5413 TCX", name: "Depth Charge" },
            { rgb: "3a445d", p_rgb: "3b4559", sim: 98, pantone: "2379 C", name: "Diplomatic" },
            { rgb: "ffd8bb", p_rgb: "ffd4b2", sim: 98, pantone: "13-1026 TPX", name: "Durazno Palido" },
            { rgb: "0abab5", p_rgb: "00baae", sim: 97, pantone: "3262 U", name: "Jade Gravel" },
            { rgb: "f7a233", p_rgb: "f9a12e", sim: 99, pantone: "15-1058 TPG", name: "Lightning Yellow" },
            { rgb: "b66a3c", p_rgb: "ba6a3b", sim: 99, pantone: "P 31-7 C", name: "Mincemeat" },
            { rgb: "6fea3e", p_rgb: "87e878", sim: 94, pantone: "902 U", name: "Miyazaki Verdant" },
            { rgb: "ec8430", p_rgb: "f38b3c", sim: 98, pantone: "144 U", name: "Navel" },
            { rgb: "a328b3", p_rgb: "9b26b6", sim: 98, pantone: "2592 C", name: "Pink Spyro" },
            { rgb: "fcffff", p_rgb: "c7dbf4", sim: 87, pantone: "2707 U", name: "Polar Bear In A Blizzard" },
            { rgb: "881166", p_rgb: "890c58", sim: 96, pantone: "228 C", name: "Possessed Purple" },
            { rgb: "11875d", p_rgb: "13955e", sim: 95, pantone: "P 145-8 U", name: "Primal Green" },
            { rgb: "8a3319", p_rgb: "8a391b", sim: 98, pantone: "7526 C", name: "Red Rust" },
            { rgb: "0c1793", p_rgb: "10069f", sim: 97, pantone: "Blue 072 C", name: "Royal" },
            { rgb: "e84998", p_rgb: "e44c9a", sim: 99, pantone: "Rhodamine Red U", name: "Schiaparelli Pink" },
            { rgb: "ffe670", p_rgb: "ffe671", sim: 100, pantone: "924 C", name: "Shandy" },
            { rgb: "7777ff", p_rgb: "6490e8", sim: 90, pantone: "2727 U", name: "Stargate Shimmer" },
            { rgb: "0c0c1f", p_rgb: "131e29", sim: 91, pantone: "7547 C", name: "Tristesse" },
            { rgb: "b12d35", p_rgb: "b42937", sim: 99, pantone: "P 58-8 C", name: "Unmatched Beauty" },
            { rgb: "e34244", p_rgb: "e73c3e", sim: 99, pantone: "2034 C", name: "Vermilion Cinnabar" },
            { rgb: "e3ac72", p_rgb: "e2a770", sim: 98, pantone: "721 CP", name: "Viva Gold" },
            { rgb: "4b57db", p_rgb: "275ea3", sim: 89, pantone: "10261 C", name: "Warm Blue" },
            { rgb: "bfd6d9", p_rgb: "bcd5d6", sim: 99, pantone: "5523 U", name: "Wind Speed" },
        ];

        let _last_color_ = [
            { rgb: "000000", p_rgb: "232222", sim: 92, pantone: "Neutral Black C", name: "Bleached Silk" }
        ]

        let _colors_ = _first_color_.concat(_other_colors_)

        for (let s of _colors_) {
            s.luminance = tinycolor(s.p_rgb).getLuminance();
        }
        _colors_ = _colors_.sort((a, b) => b.luminance - a.luminance)
        const max = _colors_[0].luminance
        const min = _colors_[_colors_.length - 1].luminance
        const normalize = (val, max, min) => (val - min) / (max - min)
        _colors_ = _first_color_.concat(shuffleArray(_other_colors_))
        let k = 0
        const transparency = .667
        _colors_.push(_last_color_[0])
        for (let s of _colors_) {
            // https://cubic-bezier.com/
            let easing = BezierEasing(.5, .5, .5, .5)
            easing = BezierEasing(0, 1, 1, .4)
            // const nl = normalize(s.luminance, max, min)
            s.nl = normalize(k++, (_colors_.length - 1) + 1, 0)
            s.brightnessChange = (1 - easing(s.nl)) * 100 // s.luminance *100 // 
            if (tinycolor(s.p_rgb).isLight()) {
                s.textColor = tinycolor(s.p_rgb).darken(s.brightnessChange).toString("hex6").slice(1)
                s.stripeColor = tinycolor(s.p_rgb).darken(10).toString("hex6").slice(1)
            } else {
                s.textColor = tinycolor(s.p_rgb).lighten(s.brightnessChange).toString("hex6").slice(1)
                s.stripeColor = tinycolor(s.p_rgb).lighten(10).toString("hex6").slice(1)
            }
            s.borderColor = tinycolor(s.p_rgb).lighten(30).toString("hex6").slice(1)
            // some transparency to show video behind
            if (ytID) {
                s.p_rgb = tinycolor(s.p_rgb).setAlpha(transparency).toString("hex8").slice(1)
                s.textColor = tinycolor(s.textColor).setAlpha(transparency).toString("hex8").slice(1)
                s.stripeColor = tinycolor(s.stripeColor).setAlpha(transparency).toString("hex8").slice(1)
                s.borderColor = tinycolor(s.borderColor).setAlpha(transparency).toString("hex8").slice(1)
            }
        }

        let $gridById = $("#grid")

        $gridById.isotope({
            layoutMode: 'packery',
            itemSelector: ".grid-brick",
            packery: {
                gutter: 0,
            }
        });

        const $bricksTemporaryContainer = $("<span>");
        const templateForTheme =
            `
<div class="grid-brick">
    <div class="d-flex brick align-items-center justify-content-center mb-3" style="border-radius: 0; background-image: url('/manuscriptFirstLine.jpg'); background-repeat: no-repeat; background-size: cover; height: 100%;">
        <div class="magnificient-card p-2" style="backdrop-filter: blur(1px);">
            ${'&nbsp;Ciaccona&nbsp;'}
        </div>
    </div>
</div>`
        $bricksTemporaryContainer.append($(templateForTheme));

        let i = 0;
        let barFrom = 0
        _colors_.forEach(function (c) {
            const tonality = (17 <= i && i < 27) ? "Δ" : "";
            const duration = index2duration(i)
            const warning = duration != 8 ? `(${duration})` : "";
            const barTo = barFrom + duration
            const bg = true ? // !tonality ?
                `background-color: #${c.p_rgb};`
                :
                `background-image: linear-gradient(135deg, 
                #${c.stripeColor} 10%, 
                #${c.p_rgb} 10%, 
                #${c.p_rgb} 50%, 
                #${c.stripeColor} 50%, 
                #${c.stripeColor} 60%, 
                #${c.p_rgb} 60%, 
                #${c.p_rgb} 100%); 
                background-size: 16.97px 16.97px;`

            const svgOffsetX = (i == 0 || i == 17 || i == 27 || i == 33 ? "0" : "6.5")

            const templateVariations =
                `
<div id="gb${i}" class="${tonality ? tonality + "2 " : ''}grid-brick" style="border-color: #${c.borderColor}">
    <div class="brick font-monospace d-flex align-items-center justify-content-between" style="${bg};" data-bar="${barFrom}">
        <div class="score" style="width: ${(_widths_[i].w) - 120}px; visibility: hidden; ">

            <object id="o${i}" 
                    data="scores/bwv-1004_5_for_PNGs-${i + 1}.svg" 
                    type="image/svg+xml"
                    style="pointer-events: none;" 
                    data-svg-offset-x = ${svgOffsetX}> 
            </object>

            <span class="Δ" style="${bg}">
                ${tonality}
            </span>
        </div>
        <div class="flex-grow-1"></div>
        <div style="${i == _colors_.length - 1 ? "display:none;" : ""}font-style: italic; font-size:.8rem; color: #${c.textColor};">
            ${warning}
        </div>
        <div style="${i == _colors_.length - 1 ? "display:none;" : ""}font-size:1.1rem; padding: 0 .3rem; border-right: .5px solid #${c.textColor}; color: #${c.textColor}">
            ${barFrom + 1}<br\>${barTo}
        </div>
        <div class="fw-bold text-center" style="${i == _colors_.length - 1 ? "display:none;" : ""}margin-top: auto; margin-bottom: .5rem; min-width: 3rem; color: #${c.textColor};">
            ${i == 0 ? "" : i}
        </div>
    </div>
</div>
`
            $bricksTemporaryContainer.append($(templateVariations));

            // bumpers
            barFrom = barFrom += duration
            i++
        });

        const oblivion =
            `
<div class="grid-brick">
    <div class="brick d-flex align-items-center justify-content-center" style="border-radius: 0; background-color: black">
        <div class="siegel">
            <div class="magnificient-card p-2" style="backdrop-filter: blur(.2px);">
                ${'&nbsp;BWV&nbsp;1004&nbsp;'}
            </div>
        </div>    
    </div>
</div>
`
        $bricksTemporaryContainer.append($(oblivion));

        const $bricks = $bricksTemporaryContainer.children();

        $gridById.empty().append($bricks).isotope('appended', $bricks);

        $(".brick").click(function (e) {
            e.stopPropagation();
            if (!ytID) {
                /* if ($('.dropdown').find('.dropdown-menu').is(":hidden")) { */
                    $('.dropdown-toggle').dropdown('toggle');
                /* } */
                /*
                console.log(e.currentTarget.parentNode)
                e.currentTarget.parentNode.classList.toggle("playing")
                */
            } else {

                const d = $(this).data()
                console.log('clicked on bar', d.bar)
                if (typeof (d.bar) != "undefined") {
                    // const state = player.getPlayerState()
                    const isPlaying = plyer.playing
                    if (previousPlayOnBar == d.bar) {
                        // just toggle play state
                        if (isPlaying) {
                            plyer.pause();
                        } else {
                            plyer.play()
                        }
                    } else {
                        let bar = all.bars[d.bar]
                        console.log("seeking (on click)", bar["Time Recorded"])
                        plyer.currentTime = bar.duration.asSeconds()
                        if (!isPlaying) {
                            plyer.play()
                        }
                        previousPlayOnBar = d.bar
                        Cookies.set('previousPlayOnBar', d.bar)
                    }
                }
            }
        });

    </script>
</body>

</html>