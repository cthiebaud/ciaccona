<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">

    <script src="https://cdn.jsdelivr.net/npm/moment@latest/moment.min.js"></script>

    <!-- Include Handlebars from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>

    <!-- https://github.com/handlebars-lang/handlebars.js/blob/master/FAQ.md -->
    <script id="head-template" type="text/x-handlebars-template"><!DOCTYPE html>
<html>
<head>
    <!-- Google tag (gtag.js) -->
    <scr{{!}}ipt async src="https://www.googletagmanager.com/gtag/js?id=G-DJBNRY1Z9M"></scr{{!}}ipt>
    <scr{{!}}ipt>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-DJBNRY1Z9M');
    </scr{{!}}ipt>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="keywords" content="Bach, JSBach, BWV1004, Partita, Ciaconna, Chaconne, {{artist}}">
    <meta name="author" content="Christophe Thiebaud">

    <!-- HTML Meta Tags -->
    <title>{{title}}</title>
    <meta name="description" content="{{{description}}}">

    <!-- Facebook Meta Tags -->
    <meta property="fb:app_id" content="176898451849553">
    <meta property="og:locale" content="en_GB" />
    <meta property="og:site_name" content="ciaccona.cthiebaud.com">
    <meta property="og:url" content="{{url}}">
    <meta property="og:type" content="website">
    <meta property="og:title" content="{{title}}">
    <meta property="og:description" content="{{{description}}}">
    <meta property="og:image" content="{{image}}">
    <meta property="og:image:url" content="{{image}}">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="2400">
    <meta property="og:image:height" content="1256">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@cthiebaud">
    <meta property="twitter:domain" content="ciaccona.cthiebaud.com">
    <meta property="twitter:url" content="{{url}}">
    <meta name="twitter:title" content="{{title}}">
    <meta name="twitter:description" content="{{{description}}}">
    <meta name="twitter:image" content="{{image}}">
    <scr{{!}}ipt>
        window.location.href = "/?a={{key}}"
    </scr{{!}}ipt>
</head>
</html>
</script>

    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <script type="module">
        import jquery from 'https://cdn.jsdelivr.net/npm/jquery@3.6.4/+esm'
        import { loadArtists } from "/js/__artists.js"

        loadArtists().then((artists) => {

            const source = document.getElementById("head-template").innerHTML;
            const template = Handlebars.compile(source);
            const BreakException = {};
            const count = artists.size() - 1
            let i = 1
            // Object.keys(artists).forEach((key) => {
            const sorted = artists.artists/* .sort((a, b) => b['▶'].viewsPerMonth - a['▶'].viewsPerMonth) */
            sorted.forEach((artist) => {
                console.log(artist.fullname, artist['▶'].viewsPerMonth, artist['▶'].url)
                const key = artist.fullnameNoSpaceLowercaseNoDiacritics
                const results = template({
                    key: key,
                    artist: artist.fullname,
                    videoID: artist['▶'].id,
                    title: `Ciaccona - ${artist.fullname}`,
                    url: `https://ciaccona.cthiebaud/video/${key}.html`,
                    description: `${artist.fullname} performing the Chaconne from Johann Sebastian Bach's Partita in D minor for solo violin (BWV 1004), collated with ${count}+ other performers.`,
                    image: `https://ciaccona.cthiebaud.com/screenshots/${key}.jpg`,
                });

                // console.log('pushed', key)
                /*     
                setTimeout(() => {
                    var blob = new Blob([results], { type: "text/plain;charset=utf-8" });
                    saveAs(blob, `_${key}.html`);
                    console.log('saved', key)
                }, 300 * i++)
                */
                // throw BreakException;
            })
        })
    </script>
</head>

</html>